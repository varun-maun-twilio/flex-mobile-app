"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[412],{2537:function(e,t,n){/*
@license
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2019, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes javascript-state-machine under the following license.

    Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes q under the following license.

    Copyright 2009â€“2014 Kristopher Michael Kowal. All rights reserved.
    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to
    deal in the Software without restriction, including without limitation the
    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
    sell copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in
    all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
    IN THE SOFTWARE.

This software includes platform.js under the following license.

    Copyright 2014 Benjamin Tan <https://d10.github.io/>
    Copyright 2011-2015 John-David Dalton <http://allyoucanleet.com/>

    Permission is hereby granted, free of charge, to any person obtaining
    a copy of this software and associated documentation files (the
    "Software"), to deal in the Software without restriction, including
    without limitation the rights to use, copy, modify, merge, publish,
    distribute, sublicense, and/or sell copies of the Software, and to
    permit persons to whom the Software is furnished to do so, subject to
    the following conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
    LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
    OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
    WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/ Object.defineProperty(t,"__esModule",{value:!0}),n(1299),n(2419),n(7941),n(2526),n(7327),n(5003),n(9337);var i,r,s=n(7156),a=n(6115),o=n(1655),u=n(4993),c=n(3808),d=n(8416),l=n(9728),p=n(6690);n(1539),n(8674),n(1249),n(4747);var f=n(4687),h=n(8698);n(2222),n(1038),n(8783);var y=n(2043),v=n(2604);n(6992),n(3948),n(8862),n(9653),n(4916),n(5306),n(9600);var m=n(9528);n(6699);var g=n(9098),b=n(2307);n(7042),n(8309),n(7601),n(1817),n(2165);var _=n(7424);n(1532);var k=n(9575),w=n(7766),x=n(4122),C=n(4929),S=n(4452),P=n(861);n(189),n(3161),n(2472),n(8675),n(2990),n(8927),n(3105),n(5035),n(4345),n(7174),n(2846),n(4731),n(7209),n(6319),n(8867),n(7789),n(3739),n(9368),n(4483),n(2056),n(4141),n(678),n(7462),n(3824),n(5021),n(2974),n(5016),n(8264),n(7514),n(2707),n(2023);var E=n(8724);n(9826),n(561),n(9720);var R=n(5877);function T(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var O=T(s),M=T(a),U=T(o),I=T(u),N=T(c),j=T(d),A=T(l),F=T(p),D=T(f),B=T(h),L=function(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}(y),z=T(b),J=T(_),q=T(P);function G(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if(("undefined"==typeof Reflect?"undefined":B.default(Reflect))==="object"&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a}function H(e,t){if(("undefined"==typeof Reflect?"undefined":B.default(Reflect))==="object"&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function V(e,t){return["".concat(new Date().toISOString()," Conversations ").concat(e,":")].concat(Array.from(t))}var W=L.getLogger("twilio-conversations"),$=function(){function e(t){F.default(this,e),j.default(this,"prefix",""),this.prefix=null!=t&&t.length>0?t+" ":""}return A.default(e,[{key:"setLevel",value:function(e){W.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];W.trace.apply(null,V(this.prefix+"T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];W.debug.apply(null,V(this.prefix+"D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];W.info.apply(null,V(this.prefix+"I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];W.warn.apply(null,V(this.prefix+"W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];W.error.apply(null,V(this.prefix+"E",t))}}],[{key:"scope",value:function(t){return new e(t)}},{key:"setLevel",value:function(e){W.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];W.trace.apply(null,V("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];W.debug.apply(null,V("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];W.info.apply(null,V("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];W.warn.apply(null,V("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];W.error.apply(null,V("E",t))}}]),e}();function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}var X="PT5S",Z="PT5S",K=A.default(function e(){var t,n,i,r,s,a,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;F.default(this,e),j.default(this,"typingIndicatorTimeoutDefault",5e3);var d=o.Chat||o.IPMessaging||o||{};this.productId=d.productId,this.links={myConversations:u.links.my_conversations,conversations:u.links.conversations,users:u.links.users,currentUser:u.links.current_user,typing:u.links.typing,mediaService:u.links.media_service,mediaSetService:u.links.media_set_service,messagesReceipts:u.links.messages_receipts},this.limits={mediaAttachmentsCountLimit:u.options.media_attachments_count_limit,mediaAttachmentSizeLimitInMb:u.options.media_attachment_size_limit_in_mb,mediaAttachmentsTotalSizeLimitInMb:u.options.media_attachments_total_size_limit_in_mb,emailHistoriesAllowedContentTypes:u.options.email_histories_allowed_mime_types,emailBodiesAllowedContentTypes:u.options.email_bodies_allowed_mime_types},this.typingIndicatorTimeoutOverride=d.typingIndicatorTimeoutOverride,this.backoffConfiguration=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach(function(t){j.default(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({min:1e3,max:4e3,maxAttemptsCount:3},d.backoffConfigOverride),this.retryWhenThrottled=void 0===d.retryWhenThrottledOverride||d.retryWhenThrottledOverride,this.userInfosToSubscribe=null!==(t=null!==(n=d.userInfosToSubscribeOverride)&&void 0!==n?n:u.options.user_infos_to_subscribe)&&void 0!==t?t:100,this.reachabilityEnabled=u.options.reachability_enabled,this.userIdentity=u.identity,this.userInfo=u.sync_objects.my_user_info,this.myConversations=u.sync_objects.my_conversations;var l=null!==(i=null!==(r=d.httpCacheIntervalOverride)&&void 0!==r?r:u.options.http_cache_interval)&&void 0!==i?i:X;try{this.httpCacheInterval=v.toSeconds(v.parse(l))}catch(p){c.error("Failed to parse http cache interval ".concat(l,", using default value ").concat(X)),this.httpCacheInterval=v.toSeconds(v.parse(X))}var f=null!==(s=null!==(a=d.consumptionReportIntervalOverride)&&void 0!==a?a:u.options.consumption_report_interval)&&void 0!==s?s:Z;try{this.consumptionReportInterval=v.toSeconds(v.parse(f))}catch(h){c.error("Failed to parse consumption report interval ".concat(f,", using default value ").concat(Z)),this.consumptionReportInterval=v.toSeconds(v.parse(Z))}});function Q(e){return void 0===e||isNaN(Number(e))?null:Number(e)}function ee(e){try{return new Date(e)}catch(t){return null}}function et(e,t,n){var i={};if(e)try{i=JSON.parse(e)}catch(r){n.warn(t,r)}return i}var en=function(){function e(t){F.default(this,e),this.base=t.replace(/\/$/,""),this.args=[],this.paths=[]}return A.default(e,[{key:"arg",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"path",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}(),ei=m.custom(function(e){return[["string","number","boolean","object"].includes(B.default(e)),"a JSON type"]}),er=m.custom(function(e){return[["undefined","string","number","boolean","object"].includes(B.default(e)),"an optional JSON type"]}),es=$.scope("User"),ea=function(e){U.default(l,e);var t,n,i,r,s,a,o,u,c,d=(n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=N.default(l);if(n){var i=N.default(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return I.default(this,e)});function l(e,t,n,i){var r;return F.default(this,l),r=d.call(this),j.default(M.default(r),"promiseToFetch",null),j.default(M.default(r),"updated","updated"),j.default(M.default(r),"userSubscribed","userSubscribed"),j.default(M.default(r),"userUnsubscribed","userUnsubscribed"),r.services=i,r.subscribed="initializing",r.setMaxListeners(0),r.state={identity:e,entityName:t,friendlyName:null,attributes:{},online:null,notifiable:null},r._initializationPromise=new Promise(function(e){r._resolveInitializationPromise=e}),null!==n&&r._resolveInitialization(n,e,t,!1),r}return A.default(l,[{key:"identity",get:function(){return this.state.identity},set:function(e){this.state.identity=e}},{key:"entityName",set:function(e){this.state.entityName=e}},{key:"attributes",get:function(){return this.state.attributes}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"isOnline",get:function(){return this.state.online}},{key:"isNotifiable",get:function(){return this.state.notifiable}},{key:"isSubscribed",get:function(){return"subscribed"==this.subscribed}},{key:"_update",value:(i=O.default(D.default.mark(function e(t,n){var i,r;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:i=[],es.debug("User for",this.state.identity,"updated:",t,n),e.t0=t,e.next="friendlyName"===e.t0?7:"attributes"===e.t0?9:"reachability"===e.t0?12:15;break;case 7:return this.state.friendlyName!==n.value&&(i.push("friendlyName"),this.state.friendlyName=n.value),e.abrupt("break",16);case 9:return r=et(n.value,"Retrieved malformed attributes from the server for user: ".concat(this.state.identity),es),z.default(this.state.attributes,r)||(this.state.attributes=r,i.push("attributes")),e.abrupt("break",16);case 12:return this.state.online!==n.online&&(this.state.online=n.online,i.push("reachabilityOnline")),this.state.notifiable!==n.notifiable&&(this.state.notifiable=n.notifiable,i.push("reachabilityNotifiable")),e.abrupt("break",16);case 15:return e.abrupt("return");case 16:i.length>0&&this.emit("updated",{user:this,updateReasons:i});case 17:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"_updateReachabilityInfo",value:(r=O.default(D.default.mark(function e(t,n){var i=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if(this.configuration.reachabilityEnabled){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:return e.abrupt("return",t.get("reachability").then(n).catch(function(e){es.warn("Failed to get reachability info for ",i.state.identity,e)}));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"_fetch",value:(s=O.default(D.default.mark(function e(){var t=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if(this.state.entityName){e.next=4;break}return e.abrupt("return",this);case 4:return this.promiseToFetch=this.services.syncClient.map({id:this.state.entityName,mode:"open_existing",includeItems:!0}).then(function(e){return t.entity=e,e.on("itemUpdated",function(e){return es.debug(t.state.entityName+" ("+t.state.identity+") itemUpdated: "+e.item.key),t._update(e.item.key,e.item.data)}),Promise.all([e.get("friendlyName").then(function(e){return t._update(e.key,e.data)}),e.get("attributes").then(function(e){return t._update(e.key,e.data)}),t._updateReachabilityInfo(e,function(e){return t._update(e.key,e.data)})])}).then(function(){return es.debug("Fetched for",t.identity),t.subscribed="subscribed",t.emit("userSubscribed",t),t}).catch(function(e){throw t.promiseToFetch=null,e}),e.abrupt("return",this.promiseToFetch);case 6:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"_ensureFetched",value:(a=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:return e.abrupt("return",this.promiseToFetch||this._fetch());case 3:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"updateAttributes",value:(o=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if("unsubscribed"!=this.subscribed){e.next=4;break}throw Error("Can't modify unsubscribed object");case 4:return e.next=6,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:JSON.stringify(t)});case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"updateFriendlyName",value:(u=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if("unsubscribed"!=this.subscribed){e.next=4;break}throw Error("Can't modify unsubscribed object");case 4:return e.next=6,this.services.commandExecutor.mutateResource("post",this.links.self,{friendly_name:t});case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"unsubscribe",value:(c=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if(!this.promiseToFetch){e.next=9;break}return e.next=5,this.promiseToFetch;case 5:this.entity.close(),this.promiseToFetch=null,this.subscribed="unsubscribed",this.emit("userUnsubscribed",this);case 9:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"_resolveInitialization",value:function(e,t,n,i){this.configuration=e,this.identity=t,this.entityName=n,this.links={self:"".concat(this.configuration.links.users,"/").concat(encodeURIComponent(this.identity))},this._resolveInitializationPromise(),i&&this.emit("updated",{user:this,updateReasons:["friendlyName","attributes","reachabilityOnline","reachabilityNotifiable"]})}}]),l}(g.ReplayEventEmitter);function eo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}G([m.validateTypesAsync(ei),H("design:type",Function),H("design:paramtypes",[Object]),H("design:returntype",Promise)],ea.prototype,"updateAttributes",null),G([m.validateTypesAsync(["string"]),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],ea.prototype,"updateFriendlyName",null);var eu=function(){var e;function t(e,n){F.default(this,t),this.configuration=e,this.services=n,this.cache=new Map,this.cacheLifetime=100*this.configuration.httpCacheInterval,this.cleanupCache()}return A.default(t,[{key:"isExpired",value:function(e){return!this.cacheLifetime||Date.now()-e>this.cacheLifetime}},{key:"cleanupCache",value:function(){var e,t=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return eo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eo(e,t)}}(e))){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}(this.cache);try{for(t.s();!(e=t.n()).done;){var n=J.default(e.value,2),i=n[0],r=n[1];this.isExpired(r.timestamp)&&this.cache.delete(i)}}catch(s){t.e(s)}finally{t.f()}0===this.cache.size&&clearInterval(this.timer)}},{key:"pokeTimer",value:function(){var e=this;this.timer=this.timer||setInterval(function(){return e.cleanupCache()},2*this.cacheLifetime)}},{key:"executeWithRetry",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(i,r){var s=[502,503,504];n&&s.push(429);var a=new k.Retrier(t.configuration.backoffConfiguration);a.on("attempt",function(){e().then(function(e){return a.succeeded(e)}).catch(function(e){s.indexOf(e.status)>-1?a.failed(e):"Twilsock disconnected"===e.message?a.failed(e):(a.removeAllListeners(),a.cancel(),r(e))})}),a.on("succeeded",function(e){i(e)}),a.on("cancelled",function(e){return r(e)}),a.on("failed",function(e){return r(e)}),a.start()})}},{key:"get",value:(e=O.default(D.default.mark(function e(t){var n,i,r,s=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=this.cache.get(t))&&!this.isExpired(n.timestamp))){e.next=3;break}return e.abrupt("return",n.response);case 3:return i={},e.next=6,this.executeWithRetry(function(){return s.services.transport.get(t,i,s.configuration.productId)},this.configuration.retryWhenThrottled);case 6:return r=e.sent,this.cache.set(t,{response:r,timestamp:Date.now()}),this.pokeTimer(),e.abrupt("return",r);case 10:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})}]),t}(),ec=A.default(function e(){F.default(this,e)});j.default(ec,"TYPING_INDICATOR","twilio.ipmsg.typing_indicator"),j.default(ec,"NEW_MESSAGE","twilio.conversations.new_message"),j.default(ec,"ADDED_TO_CONVERSATION","twilio.conversations.added_to_conversation"),j.default(ec,"REMOVED_FROM_CONVERSATION","twilio.conversations.removed_from_conversation"),j.default(ec,"CONSUMPTION_UPDATE","twilio.channel.consumption_update");var ed=$.scope("Participant"),el=function(e){U.default(o,e);var t,n,i,r,s,a=(n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=N.default(o);if(n){var i=N.default(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return I.default(this,e)});function o(e,t,n,i,r){var s,u,c;if(F.default(this,o),(c=a.call(this)).conversation=n,c.links=i,c.services=r,c.state={attributes:et(e.attributes,"Retrieved malformed attributes from the server for participant: "+t,ed),dateCreated:e.dateCreated?ee(e.dateCreated):null,dateUpdated:e.dateCreated?ee(e.dateUpdated):null,sid:t,typingTimeout:null,isTyping:!1,identity:e.identity,roleSid:null!==(s=e.roleSid)&&void 0!==s?s:"",lastReadMessageIndex:Number.isInteger(e.lastConsumedMessageIndex)?e.lastConsumedMessageIndex:null,lastReadTimestamp:e.lastConsumptionTimestamp?ee(e.lastConsumptionTimestamp):null,type:e.type||"chat",userInfo:e.userInfo,bindings:null!==(u=e.bindings)&&void 0!==u?u:{}},!e.identity&&!e.type)throw Error("Received invalid Participant object from server: Missing identity or type of Participant.");return c}return A.default(o,[{key:"sid",get:function(){return this.state.sid}},{key:"attributes",get:function(){return this.state.attributes}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"identity",get:function(){return this.state.identity}},{key:"isTyping",get:function(){return this.state.isTyping}},{key:"lastReadMessageIndex",get:function(){return this.state.lastReadMessageIndex}},{key:"lastReadTimestamp",get:function(){return this.state.lastReadTimestamp}},{key:"roleSid",get:function(){return this.state.roleSid}},{key:"type",get:function(){return this.state.type}},{key:"bindings",get:function(){var e;return null!==(e=this.state.bindings)&&void 0!==e?e:{}}},{key:"_startTyping",value:function(e){var t=this;return this.state.typingTimeout&&clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit("typingStarted",this),this.conversation.emit("typingStarted",this),this.state.typingTimeout=Number(setTimeout(function(){return t._endTyping()},e)),this}},{key:"_endTyping",value:function(){this.state.typingTimeout&&(this.state.isTyping=!1,this.emit("typingEnded",this),this.conversation.emit("typingEnded",this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{key:"_update",value:function(e){var t=[],n=et(e.attributes,"Retrieved malformed attributes from the server for participant: "+this.state.sid,ed);e.attributes&&!z.default(this.state.attributes,n)&&(this.state.attributes=n,t.push("attributes"));var i=ee(e.dateUpdated);e.dateUpdated&&(null==i?void 0:i.getTime())!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=i,t.push("dateUpdated"));var r=ee(e.dateCreated);if(e.dateCreated&&(null==r?void 0:r.getTime())!==(this.state.dateCreated&&this.state.dateCreated.getTime())&&(this.state.dateCreated=r,t.push("dateCreated")),e.roleSid&&this.state.roleSid!==e.roleSid&&(this.state.roleSid=e.roleSid,t.push("roleSid")),(Number.isInteger(e.lastConsumedMessageIndex)||null===e.lastConsumedMessageIndex)&&this.state.lastReadMessageIndex!==e.lastConsumedMessageIndex&&(this.state.lastReadMessageIndex=e.lastConsumedMessageIndex,t.push("lastReadMessageIndex")),e.lastConsumptionTimestamp){var s=new Date(e.lastConsumptionTimestamp);this.state.lastReadTimestamp&&this.state.lastReadTimestamp.getTime()===s.getTime()||(this.state.lastReadTimestamp=s,t.push("lastReadTimestamp"))}return e.bindings&&!z.default(this.state.bindings,e.bindings)&&(this.state.bindings=e.bindings,t.push("bindings")),t.length>0&&this.emit("updated",{participant:this,updateReasons:t}),this}},{key:"getUser",value:(i=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("chat"!=this.type)){e.next=2;break}throw Error("Getting User is not supported for this Participant type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUser(this.state.identity,this.state.userInfo));case 3:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"remove",value:(r=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.conversation.removeParticipant(this));case 1:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"updateAttributes",value:(s=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:JSON.stringify(t)});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})}]),o}(g.ReplayEventEmitter);j.default(el,"typingStarted","typingStarted"),j.default(el,"typingEnded","typingEnded"),j.default(el,"updated","updated"),G([m.validateTypesAsync(ei),H("design:type",Function),H("design:paramtypes",[Object]),H("design:returntype",Promise)],el.prototype,"updateAttributes",null);var ep=$.scope("Participants"),ef=function(e){U.default(p,e);var t,n,i,r,s,a,o,u,c,d,l=(n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=N.default(p);if(n){var i=N.default(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return I.default(this,e)});function p(e,t,n,i,r){var s;return F.default(this,p),s=l.call(this),j.default(M.default(s),"rosterEntityPromise",null),s.conversation=e,s.participants=t,s.links=n,s.configuration=i,s.services=r,s}return A.default(p,[{key:"unsubscribe",value:(i=O.default(D.default.mark(function e(){var t;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rosterEntityPromise){e.next=6;break}return e.next=3,this.rosterEntityPromise;case 3:(0,e.sent).close(),this.rosterEntityPromise=null;case 6:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"subscribe",value:function(e){var t=this,n="string"==typeof e?this.services.syncClient.map({id:e,mode:"open_existing"}):Promise.resolve(e);return this.rosterEntityPromise=this.rosterEntityPromise||n.then(function(e){e.on("itemAdded",function(e){ep.debug(t.conversation.sid+" itemAdded: "+e.item.key),t.upsertParticipant(e.item.key,e.item.data).then(function(e){t.emit("participantJoined",e)})}),e.on("itemRemoved",function(e){ep.debug(t.conversation.sid+" itemRemoved: "+e.key);var n=e.key;if(t.participants.has(n)){var i=t.participants.get(n);t.participants.delete(n),i&&t.emit("participantLeft",i)}}),e.on("itemUpdated",function(e){ep.debug(t.conversation.sid+" itemUpdated: "+e.item.key),t.upsertParticipant(e.item.key,e.item.data)});var n=[],i=function e(i){return i.items.forEach(function(e){n.push(t.upsertParticipant(e.key,e.data))}),i.hasNextPage?i.nextPage().then(e):null};return e.getItems().then(i).then(function(){return Promise.all(n)}).then(function(){return e})}).catch(function(e){throw t.rosterEntityPromise=null,"disconnected"!=t.services.syncClient.connectionState&&ep.error("Failed to get roster object for conversation",t.conversation.sid,e),ep.debug("ERROR: Failed to get roster object for conversation",t.conversation.sid,e),e})}},{key:"upsertParticipantFromResponse",value:(r=O.default(D.default.mark(function e(t){var n,i,r,s,a,o,u,c;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.sid,r=t.attributes,s=t.date_created,a=t.date_updated,o=t.identity,u=t.role_sid,c=t.messaging_binding,e.next=3,this.upsertParticipant(i,{attributes:r,dateCreated:new Date(s),dateUpdated:new Date(a),identity:o,roleSid:u,lastConsumedMessageIndex:null,lastConsumptionTimestamp:null,type:null!==(n=null==c?void 0:c.type)&&void 0!==n?n:"chat"});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"upsertParticipant",value:(s=O.default(D.default.mark(function e(t,n){var i,r,s=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=this.participants.get(t))){e.next=3;break}return e.abrupt("return",i._update(n));case 3:return r={self:"".concat(this.links.participants,"/").concat(t)},i=new el(n,t,this.conversation,r,this.services),this.participants.set(t,i),i.on("updated",function(e){return s.emit("participantUpdated",e)}),e.abrupt("return",i);case 8:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"getParticipants",value:(a=O.default(D.default.mark(function e(){var t=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then(function(){var e=[];return t.participants.forEach(function(t){return e.push(t)}),e}):[]);case 1:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"getParticipantBySid",value:(o=O.default(D.default.mark(function e(t){var n=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then(function(){var e=n.participants.get(t);if(!e)throw Error("Participant with SID "+t+" was not found");return e}):null);case 1:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"getParticipantByIdentity",value:(u=O.default(D.default.mark(function e(t){var n,i=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then(function(){if(i.participants.forEach(function(e){e.identity===t&&(n=e)}),!n)throw Error("Participant with identity "+t+" was not found");return n}):null);case 2:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"add",value:(c=O.default(D.default.mark(function e(t,n){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.participants,{identity:t,attributes:void 0!==n?JSON.stringify(n):void 0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"addNonChatParticipant",value:(d=O.default(D.default.mark(function e(t,n){var i,r,s,a,o=arguments;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=o.length>2&&void 0!==o[2]?o[2]:{},a=o.length>3&&void 0!==o[3]?o[3]:{},e.next=4,this.services.commandExecutor.mutateResource("post",this.links.participants,{attributes:void 0!==s?JSON.stringify(s):void 0,messaging_binding:{address:n,proxy_address:t,name:null==a?void 0:null===(i=a.email)||void 0===i?void 0:i.name,level:null==a?void 0:null===(r=a.email)||void 0===r?void 0:r.level}});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return d.apply(this,arguments)})},{key:"remove",value:function(e){return this.services.commandExecutor.mutateResource("delete","".concat(this.links.participants,"/").concat(e))}}]),p}(g.ReplayEventEmitter),eh=function(){function e(t,n){F.default(this,e),j.default(this,"mcsMedia",null),this.services=n,t instanceof S.McsMedia&&(this.mcsMedia=t),this.state={sid:t.sid,category:t.category,filename:t.filename,contentType:t.contentType,size:t.size}}return A.default(e,[{key:"sid",get:function(){return this.state.sid}},{key:"filename",get:function(){return this.state.filename}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"category",get:function(){return this.state.category}},{key:"getContentTemporaryUrl",value:function(){var e,t=this;return new S.CancellablePromise((e=O.default(D.default.mark(function e(n,i,r){var s,a,o,u;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t._fetchMcsMedia(),o=null===(s=t.mcsMedia)||void 0===s?void 0:s.getContentUrl(),r(function(){a.cancel(),o&&o.cancel()}),e.prev=3,t.mcsMedia){e.next=9;break}return e.next=7,a;case 7:o=(0,e.sent).getContentUrl();case 9:if(e.t0=n,!o){e.next=16;break}return e.next=13,o;case 13:e.t1=e.sent,e.next=17;break;case 16:e.t1=null;case 17:e.t2=e.t1,(0,e.t0)(e.t2),e.next=24;break;case 21:e.prev=21,e.t3=e.catch(3),i(e.t3);case 24:case"end":return e.stop()}},e,null,[[3,21]])})),function(t,n,i){return e.apply(this,arguments)}))}},{key:"_fetchMcsMedia",value:function(){var e,t=this;return new S.CancellablePromise((e=O.default(D.default.mark(function e(n,i,r){var s;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.services.mcsClient.get(t.state.sid),!t.services.mcsClient){e.next=14;break}return r(function(){return s.cancel()}),e.prev=3,e.next=6,s;case 6:t.mcsMedia=e.sent,n(t.mcsMedia),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),i(e.t0);case 13:return e.abrupt("return");case 14:i(Error("Media Content Service is unavailable"));case 15:case"end":return e.stop()}},e,null,[[3,10]])})),function(t,n,i){return e.apply(this,arguments)}))}}]),e}(),ey=function(){function e(t){F.default(this,e),this.state=t}return A.default(e,[{key:"total",get:function(){return this.state.total}},{key:"sent",get:function(){return this.state.sent}},{key:"delivered",get:function(){return this.state.delivered}},{key:"read",get:function(){return this.state.read}},{key:"undelivered",get:function(){return this.state.undelivered}},{key:"failed",get:function(){return this.state.failed}},{key:"_update",value:function(e){this.state=e}},{key:"_isEquals",value:function(e){var t=this.total===e.total,n=this.sent===e.sent,i=this.delivered===e.delivered,r=this.read===e.read,s=this.undelivered===e.undelivered,a=this.failed===e.failed;return t&&n&&i&&r&&s&&a}}]),e}(),ev=function(){function e(t,n,i,r){F.default(this,e),this.state={prevToken:i,nextToken:r,source:n,items:t}}return A.default(e,[{key:"hasNextPage",get:function(){return!!this.state.nextToken}},{key:"hasPrevPage",get:function(){return!!this.state.prevToken}},{key:"items",get:function(){return this.state.items}},{key:"nextPage",value:function(){return this.hasNextPage?this.state.source(this.state.nextToken):Promise.reject(Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.state.source(this.state.prevToken):Promise.reject(Error("No previous page"))}}]),e}(),em=A.default(function e(t){F.default(this,e),this.sid=t.sid,this.messageSid=t.message_sid,this.conversationSid=t.conversation_sid,this.channelMessageSid=t.channel_message_sid,this.participantSid=t.participant_sid,this.status=t.status||"queued",this.errorCode=t.error_code||0,this.dateCreated=t.date_created,this.dateUpdated=t.date_updated});function eg(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function eb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eg(Object(n),!0).forEach(function(t){j.default(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eg(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var e_=$.scope("Message"),ek=function(e){U.default(l,e);var t,n,i,r,s,a,o,u,c,d=(n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=N.default(l);if(n){var i=N.default(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return I.default(this,e)});function l(e,t,n,i,r,s){var a,o,u,c,p;return F.default(this,l),(p=d.call(this)).conversation=n,p.links=i,p.configuration=r,p.services=s,p.state={sid:t.sid,index:e,author:t.author,subject:t.subject,body:null!==(a=t.text)&&void 0!==a?a:null,timestamp:t.timestamp?new Date(t.timestamp):null,dateUpdated:t.dateUpdated?new Date(t.dateUpdated):null,lastUpdatedBy:null!==(o=t.lastUpdatedBy)&&void 0!==o?o:null,attributes:et(t.attributes,"Got malformed attributes for the message ".concat(t.sid),e_),type:null!==(u=t.type)&&void 0!==u?u:"text",media:"media"===t.type&&t.media?new eh(t.media,p.services):null,medias:"media"===t.type&&t.medias?t.medias.map(function(e){return new eh(e,p.services)}):"media"===t.type&&t.media&&!t.medias?[new eh(eb(eb({},t.media),{},{category:"media"}),p.services)]:null,participantSid:null!==(c=t.memberSid)&&void 0!==c?c:null,aggregatedDeliveryReceipt:t.delivery?new ey(t.delivery):null},p}return A.default(l,[{key:"sid",get:function(){return this.state.sid}},{key:"author",get:function(){return this.state.author}},{key:"subject",get:function(){return this.state.subject}},{key:"body",get:function(){return this.state.body}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"index",get:function(){return this.state.index}},{key:"lastUpdatedBy",get:function(){return this.state.lastUpdatedBy}},{key:"dateCreated",get:function(){return this.state.timestamp}},{key:"attributes",get:function(){return this.state.attributes}},{key:"type",get:function(){return this.state.type}},{key:"media",get:function(){return this.state.media}},{key:"attachedMedia",get:function(){return this.getMediaByCategories(["media"])}},{key:"participantSid",get:function(){return this.state.participantSid}},{key:"aggregatedDeliveryReceipt",get:function(){return this.state.aggregatedDeliveryReceipt}},{key:"getMediaByCategory",value:function(e){return this.getMediaByCategories(e)}},{key:"getMediaByCategories",value:function(e){var t;return(null!==(t=this.state.medias)&&void 0!==t?t:[]).filter(function(t){return e.includes(t.category)})}},{key:"getEmailBody",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"text/plain";return null!==(e=null===(t=this.getMediaByCategories(["body"]))||void 0===t?void 0:t.filter(function(e){return e.contentType==n}).shift())&&void 0!==e?e:null}},{key:"getEmailHistory",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"text/plain";return null!==(e=null===(t=this.getMediaByCategories(["history"]))||void 0===t?void 0:t.filter(function(e){return e.contentType==n}).shift())&&void 0!==e?e:null}},{key:"_update",value:function(e){var t=[];(e.text||"string"==typeof e.text)&&e.text!==this.state.body&&(this.state.body=e.text,t.push("body")),e.subject&&e.subject!==this.state.subject&&(this.state.subject=e.subject,t.push("subject")),e.lastUpdatedBy&&e.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=e.lastUpdatedBy,t.push("lastUpdatedBy")),e.author&&e.author!==this.state.author&&(this.state.author=e.author,t.push("author")),e.dateUpdated&&new Date(e.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(e.dateUpdated),t.push("dateUpdated")),e.timestamp&&new Date(e.timestamp).getTime()!==(this.state.timestamp&&this.state.timestamp.getTime())&&(this.state.timestamp=new Date(e.timestamp),t.push("dateCreated"));var n=et(e.attributes,"Got malformed attributes for the message ".concat(this.sid),e_);z.default(this.state.attributes,n)||(this.state.attributes=n,t.push("attributes"));var i=e.delivery,r=this.state.aggregatedDeliveryReceipt;i&&i.total&&i.delivered&&i.failed&&i.read&&i.sent&&i.undelivered&&(r?r._isEquals(i)||(r._update(i),t.push("deliveryReceipt")):(this.state.aggregatedDeliveryReceipt=new ey(i),t.push("deliveryReceipt"))),t.length>0&&this.emit("updated",{message:this,updateReasons:t})}},{key:"getParticipant",value:(i=O.default(D.default.mark(function e(){var t,n,i=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!this.state.participantSid){e.next=5;break}return e.next=4,this.conversation.getParticipantBySid(this.state.participantSid).catch(function(){return e_.debug('Participant with sid "'.concat(i.participantSid,'" not found for message ').concat(i.sid)),null});case 4:t=e.sent;case 5:if(!(!t&&this.state.author)){e.next=9;break}return e.next=8,this.conversation.getParticipantByIdentity(this.state.author).catch(function(){return e_.debug('Participant with identity "'.concat(i.author,'" not found for message ').concat(i.sid)),null});case 8:t=e.sent;case 9:if(!t){e.next=11;break}return e.abrupt("return",t);case 11:throw n="Participant with ",this.state.participantSid&&(n+="SID '"+this.state.participantSid+"' "),this.state.author&&(this.state.participantSid&&(n+="or "),n+="identity '"+this.state.author+"' "),"Participant with "===n&&(n="Participant "),Error(n+="was not found");case 17:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"getDetailedDeliveryReceipts",value:(r=O.default(D.default.mark(function e(){var t,n;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getDetailedDeliveryReceiptsPaginator();case 2:n=(t=e.sent).items;case 4:if(!t.hasNextPage){e.next=11;break}return e.next=7,t.nextPage();case 7:t=e.sent,n=[].concat(q.default(n),q.default(t.items)),e.next=4;break;case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"remove",value:(s=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("delete",this.links.self);case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"updateBody",value:(a=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{body:t});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"updateAttributes",value:(o=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:void 0!==t?JSON.stringify(t):void 0});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"attachTemporaryUrlsFor",value:(u=O.default(D.default.mark(function e(t){var n,i=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null==t?void 0:t.map(function(e){return e.sid}),!(this.services.mcsClient&&n)){e.next=7;break}return e.next=4,this.services.mcsClient.mediaSetGet(n);case 4:return e.abrupt("return",e.sent.map(function(e){return new eh(e,i.services)}));case 7:throw Error("Media Content Service is unavailable");case 8:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"getTemporaryContentUrlsForMedia",value:function(e){var t=e.map(function(e){return e.sid});return this.getTemporaryContentUrlsForMediaSids(t)}},{key:"getTemporaryContentUrlsForMediaSids",value:function(e){var t,n=this;return new S.CancellablePromise((t=O.default(D.default.mark(function t(i,r,s){var a,o;return D.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.services.mcsClient.mediaSetGetContentUrls(null!=e?e:[]),!(!n.services.mcsClient||!e)){t.next=4;break}return r(Error("Media Content Service is unavailable")),t.abrupt("return");case 4:return s(function(){a.cancel()}),t.prev=5,t.next=8,a;case 8:i(t.sent),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(5),r(t.t0);case 15:case"end":return t.stop()}},t,null,[[5,12]])})),function(e,n,i){return t.apply(this,arguments)}))}},{key:"getTemporaryContentUrlsForAttachedMedia",value:function(){var e,t=this.attachedMedia,n=null!==(e=null==t?void 0:t.map(function(e){return e.sid}))&&void 0!==e?e:[];return this.getTemporaryContentUrlsForMediaSids(n)}},{key:"_getDetailedDeliveryReceiptsPaginator",value:(c=O.default(D.default.mark(function e(t){var n,i,r,s=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.configuration.links.messagesReceipts.replace("%s",this.conversation.sid).replace("%s",this.sid),i=new en(n).arg("PageToken",null==t?void 0:t.pageToken).arg("PageSize",null==t?void 0:t.pageSize).build(),e.next=4,this.services.network.get(i);case 4:return r=e.sent,e.abrupt("return",new ev(r.body.delivery_receipts.map(function(e){return new em(e)}),function(e,t){return s._getDetailedDeliveryReceiptsPaginator({pageToken:e,pageSize:t})},r.body.meta.previous_token,r.body.meta.next_token));case 6:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})}]),l}(g.ReplayEventEmitter);function ew(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ex(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ex(e,t)}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function ex(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}j.default(ek,"updated","updated"),G([E.deprecated("getMediaByCategory","getMediaByCategories"),H("design:type",Function),H("design:paramtypes",[Array]),H("design:returntype",Array)],ek.prototype,"getMediaByCategory",null),G([m.validateTypes([m.nonEmptyString,"undefined"]),H("design:type",Function),H("design:paramtypes",[Object]),H("design:returntype",eh)],ek.prototype,"getEmailBody",null),G([m.validateTypes([m.nonEmptyString,"undefined"]),H("design:type",Function),H("design:paramtypes",[Object]),H("design:returntype",eh)],ek.prototype,"getEmailHistory",null),G([m.validateTypesAsync("string"),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],ek.prototype,"updateBody",null),G([m.validateTypesAsync(ei),H("design:type",Function),H("design:paramtypes",[Object]),H("design:returntype",Promise)],ek.prototype,"updateAttributes",null),G([E.deprecated("attachTemporaryUrlsFor","getTemporaryContentUrlsForMedia"),H("design:type",Function),H("design:paramtypes",[Array]),H("design:returntype",Promise)],ek.prototype,"attachTemporaryUrlsFor",null),G([m.validateTypesAsync(m.nonEmptyArray("media",eh)),H("design:type",Function),H("design:paramtypes",[Array]),H("design:returntype",S.CancellablePromise)],ek.prototype,"getTemporaryContentUrlsForMedia",null),G([m.validateTypesAsync(m.nonEmptyArray("strings","string")),H("design:type",Function),H("design:paramtypes",[Array]),H("design:returntype",S.CancellablePromise)],ek.prototype,"getTemporaryContentUrlsForMediaSids",null);var eC=$.scope("Messages"),eS=function(e){U.default(d,e);var t,n,i,r,s,a,o,u,c=(n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=N.default(d);if(n){var i=N.default(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return I.default(this,e)});function d(e,t,n){var i;return F.default(this,d),(i=c.call(this)).conversation=e,i.configuration=t,i.services=n,i.messagesByIndex=new Map,i.messagesListPromise=null,i}return A.default(d,[{key:"subscribe",value:(i=O.default(D.default.mark(function e(t){var n,i=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.messagesListPromise){e.next=2;break}return e.abrupt("return",this.messagesListPromise);case 2:return this.messagesListPromise="string"==typeof t?this.services.syncClient.list({id:t,mode:"open_existing"}):Promise.resolve(t),e.prev=3,e.next=6,this.messagesListPromise;case 6:return(n=e.sent).on("itemAdded",function(e){eC.debug("".concat(i.conversation.sid," itemAdded: ").concat(e.item.index));var t={self:"".concat(i.conversation._links.messages,"/").concat(e.item.data.sid),conversation:i.conversation._links.self,messages_receipts:"".concat(i.conversation._links.messages,"/").concat(e.item.data.sid,"/Receipts")},n=new ek(e.item.index,e.item.data,i.conversation,t,i.configuration,i.services);if(i.messagesByIndex.has(n.index)){eC.debug("Message arrived, but is already known and ignored",i.conversation.sid,n.index);return}i.messagesByIndex.set(n.index,n),n.on("updated",function(e){return i.emit("messageUpdated",e)}),i.emit("messageAdded",n)}),n.on("itemRemoved",function(e){eC.debug("#{this.conversation.sid} itemRemoved: ".concat(e.index));var t=e.index;if(i.messagesByIndex.has(t)){var n=i.messagesByIndex.get(t);if(!n)return;i.messagesByIndex.delete(n.index),n.removeAllListeners("updated"),i.emit("messageRemoved",n)}}),n.on("itemUpdated",function(e){eC.debug("".concat(i.conversation.sid," itemUpdated: ").concat(e.item.index));var t=i.messagesByIndex.get(e.item.index);t&&t._update(e.item.data)}),e.abrupt("return",n);case 13:throw e.prev=13,e.t0=e.catch(3),this.messagesListPromise=null,"disconnected"!==this.services.syncClient.connectionState&&eC.error("Failed to get messages object for conversation",this.conversation.sid,e.t0),eC.debug("ERROR: Failed to get messages object for conversation",this.conversation.sid,e.t0),e.t0;case 19:case"end":return e.stop()}},e,this,[[3,13]])})),function(e){return i.apply(this,arguments)})},{key:"unsubscribe",value:(r=O.default(D.default.mark(function e(){var t;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.messagesListPromise){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.messagesListPromise;case 4:(0,e.sent).close(),this.messagesListPromise=null;case 7:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"sendV2",value:function(e){var t,n=this;return eC.debug("Sending message V2",e.mediaContent,e.attributes,e.emailOptions),new S.CancellablePromise((t=O.default(D.default.mark(function t(i,r,s){var a,o,u,c,d,l,p,f,h,y,v,m;return D.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o=[],u=[],s(function(){u.forEach(function(e){return e.cancel()})}),c=ew(e.mediaContent),t.prev=4,c.s();case 6:if((d=c.n()).done){t.next=25;break}return p=(l=J.default(d.value,2))[0],f=l[1],t.prev=8,eC.debug("Adding media to a message as ".concat(f instanceof FormData?"FormData":"SendMediaOptions"),f),v=f instanceof FormData?n.services.mcsClient.postFormData(f,p):n.services.mcsClient.post(null!==(h=f.contentType)&&void 0!==h?h:"",null!==(y=f.media)&&void 0!==y?y:"",p,f.filename),u.push(v),t.t0=o,t.next=15,v;case 15:t.t1=t.sent,t.t0.push.call(t.t0,t.t1),t.next=23;break;case 19:return t.prev=19,t.t2=t.catch(8),r(t.t2),t.abrupt("return");case 23:t.next=6;break;case 25:t.next=30;break;case 27:t.prev=27,t.t3=t.catch(4),c.e(t.t3);case 30:return t.prev=30,c.f(),t.finish(30);case 33:return m=n.services.commandExecutor.mutateResource("post",n.conversation._links.messages,{body:e.text,subject:null===(a=e.emailOptions)||void 0===a?void 0:a.subject,media_sids:o.map(function(e){return e.sid}),attributes:void 0!==e.attributes?JSON.stringify(e.attributes):void 0}),t.prev=34,t.t4=i,t.next=38,m;case 38:t.t5=t.sent,(0,t.t4)(t.t5),t.next=45;break;case 42:t.prev=42,t.t6=t.catch(34),r(t.t6);case 45:case"end":return t.stop()}},t,null,[[4,27,30,33],[8,19],[34,42]])})),function(e,n,i){return t.apply(this,arguments)}))}},{key:"send",value:(s=O.default(D.default.mark(function e(t){var n,i,r=arguments;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},i=r.length>2?r[2]:void 0,eC.debug("Sending text message",t,n,i),e.abrupt("return",this.services.commandExecutor.mutateResource("post",this.conversation._links.messages,{body:null!=t?t:"",attributes:void 0!==n?JSON.stringify(n):void 0,subject:null==i?void 0:i.subject}));case 4:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"sendMedia",value:(a=O.default(D.default.mark(function e(t){var n,i,r,s,a,o=arguments;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:{},s=o.length>2?o[2]:void 0,eC.debug("Sending media message",t,r,s),eC.debug("Sending media message as ".concat(t instanceof FormData?"FormData":"SendMediaOptions"),t,r),!(t instanceof FormData)){e.next=10;break}return e.next=7,this.services.mcsClient.postFormData(t);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,this.services.mcsClient.post(null!==(n=t.contentType)&&void 0!==n?n:"",null!==(i=t.media)&&void 0!==i?i:"","media",t.filename);case 12:e.t0=e.sent;case 13:return a=e.t0,e.next=16,this.services.commandExecutor.mutateResource("post",this.conversation._links.messages,{media_sids:[a.sid],attributes:void 0!==r?JSON.stringify(r):void 0});case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"getMessages",value:(o=O.default(D.default.mark(function e(t,n){var i,r=arguments;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.length>2&&void 0!==r[2]?r[2]:"backwards",e.abrupt("return",this._getMessages(t,n,i));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"_wrapPaginator",value:function(e,t,n){var i=this,r="desc"===e,s=function(){return t.nextPage().then(function(t){return i._wrapPaginator(e,t,n)})},a=function(){return t.prevPage().then(function(t){return i._wrapPaginator(e,t,n)})};return n(t.items).then(function(e){return{items:e.sort(function(e,t){return e.index-t.index}),hasPrevPage:r?t.hasNextPage:t.hasPrevPage,hasNextPage:r?t.hasPrevPage:t.hasNextPage,prevPage:r?s:a,nextPage:r?a:s}})}},{key:"_upsertMessage",value:function(e,t){var n=this,i=this.messagesByIndex.get(e);if(i)return i;var r={self:"".concat(this.conversation._links.messages,"/").concat(t.sid),conversation:this.conversation._links.self,messages_receipts:"".concat(this.conversation._links.messages,"/").concat(t.sid,"/Receipts")},s=new ek(e,t,this.conversation,r,this.configuration,this.services);return this.messagesByIndex.set(s.index,s),s.on("updated",function(e){return n.emit("messageUpdated",e)}),s}},{key:"_getMessages",value:(u=O.default(D.default.mark(function e(){var t,n,i,r,s,a,o=this,u=arguments;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:30,n=u.length>1&&void 0!==u[1]?u[1]:"end",r="backwards"===(u.length>2&&void 0!==u[2]?u[2]:"forward")?"desc":"asc",e.next=6,this.messagesListPromise;case 6:return s=e.sent,e.next=9,null==s?void 0:s.getItems({from:"end"!==n?n:void 0,pageSize:t,order:r,limit:t});case 9:return a=e.sent,e.next=12,this._wrapPaginator(r,a,function(e){return Promise.all(e.map(function(e){return o._upsertMessage(e.index,e.data)}))});case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})}]),d}(g.ReplayEventEmitter),eP=function(){function e(t){F.default(this,e),j.default(this,"attributes",{}),j.default(this,"mediaContent",[]),j.default(this,"emailOptions",{}),this.messagesEntity=t}return A.default(e,[{key:"send",value:function(){var e,t=this;return new S.CancellablePromise((e=O.default(D.default.mark(function e(n,i,r){var s,a;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.messagesEntity.sendV2(t),r(function(){return s.cancel()}),e.prev=2,e.next=5,s;case 5:n(Q(e.sent.index)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),i(e.t0);case 12:case"end":return e.stop()}},e,null,[[2,9]])})),function(t,n,i){return e.apply(this,arguments)}))}}]),e}(),eE=function(){function e(t,n){F.default(this,e),this.limits=t,this.message=new eP(n),this.emailBodies=new Map,this.emailHistories=new Map}return A.default(e,[{key:"setBody",value:function(e){return this.message.text=e,this}},{key:"setSubject",value:function(e){return this.message.emailOptions.subject=e,this}},{key:"setAttributes",value:function(e){return this.message.attributes=e,this}},{key:"setEmailBody",value:function(e,t){return this.emailBodies.set(e,t),this}},{key:"setEmailHistory",value:function(e,t){return this.emailHistories.set(e,t),this}},{key:"addMedia",value:function(e){if("undefined"==typeof FormData&&e instanceof FormData)throw Error("Could not add FormData content whilst not in a browser");if(!(e instanceof FormData)&&(!e.contentType||!e.media))throw Error("Media content in SendMediaOptions must contain non-empty contentType and media");return this.message.mediaContent.push(["media",e]),this}},{key:"build",value:function(){var e=this;if(this.emailBodies.forEach(function(t,n){if(!e.limits.emailBodiesAllowedContentTypes.includes(n))throw Error("Unsupported email body content type ".concat(n))}),this.emailHistories.forEach(function(t,n){if(!e.limits.emailHistoriesAllowedContentTypes.includes(n))throw Error("Unsupported email history content type ".concat(n))}),this.emailBodies.size>this.limits.emailBodiesAllowedContentTypes.length)throw Error("Too many email bodies attached to the message (".concat(this.emailBodies.size," > ").concat(this.limits.emailBodiesAllowedContentTypes.length,")"));if(this.emailHistories.size>this.limits.emailHistoriesAllowedContentTypes.length)throw Error("Too many email histories attached to the message (".concat(this.emailHistories.size," > ").concat(this.limits.emailHistoriesAllowedContentTypes.length,")"));if(this.message.mediaContent.length>this.limits.mediaAttachmentsCountLimit)throw Error("Too many media attachments in the message (".concat(this.message.mediaContent.length," > ").concat(this.limits.mediaAttachmentsCountLimit,")"));return this.emailBodies.forEach(function(t){e.message.mediaContent.push(["body",t])}),this.emailHistories.forEach(function(t){e.message.mediaContent.push(["history",t])}),this.message}},{key:"buildAndSend",value:function(){return this.build().send()}},{key:"getPayloadContentType",value:function(e){return"undefined"!=typeof FormData&&e instanceof FormData?e.get("Content-Type"):e.contentType}}]),e}();function eR(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}var eT={lastMessage:"lastMessage",attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",notificationLevel:"notificationLevel",sid:"sid",status:"status",uniqueName:"uniqueName",state:"state",bindings:"bindings"},eO=function(e){U.default(L,e);var t,n,i,r,s,a,o,u,c,d,l,p,f,h,y,v,m,g,b,_,k,w,x,C,S,P,E,R,T,j,B=(n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=N.default(L);if(n){var i=N.default(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return I.default(this,e)});function L(e,t,n,i,r){F.default(this,L),(o=B.call(this)).sid=t,o._links=n,o._configuration=i,o._services=r,o._entityName=e.channel,o._internalState={uniqueName:e.uniqueName||null,status:"notParticipating",attributes:null!==(s=e.attributes)&&void 0!==s?s:{},createdBy:e.createdBy,dateCreated:ee(e.dateCreated),dateUpdated:ee(e.dateUpdated),friendlyName:e.friendlyName||null,lastReadMessageIndex:Number.isInteger(e.lastConsumedMessageIndex)?e.lastConsumedMessageIndex:null,bindings:null!==(a=e.bindings)&&void 0!==a?a:{}},e.notificationLevel&&(o._internalState.notificationLevel=e.notificationLevel);var s,a,o,u={participants:o._links.participants};return o._participants=new Map,o._participantsEntity=new ef(M.default(o),o._participants,u,o._configuration,o._services),o._participantsEntity.on("participantJoined",function(e){return o.emit("participantJoined",e)}),o._participantsEntity.on("participantLeft",function(e){return o.emit("participantLeft",e)}),o._participantsEntity.on("participantUpdated",function(e){return o.emit("participantUpdated",e)}),o._messagesEntity=new eS(M.default(o),i,r),o._messagesEntity.on("messageAdded",function(e){return o._onMessageAdded(e)}),o._messagesEntity.on("messageUpdated",function(e){return o.emit("messageUpdated",e)}),o._messagesEntity.on("messageRemoved",function(e){return o.emit("messageRemoved",e)}),o}return A.default(L,[{key:"uniqueName",get:function(){return this._internalState.uniqueName}},{key:"status",get:function(){return this._internalState.status}},{key:"friendlyName",get:function(){return this._internalState.friendlyName}},{key:"dateUpdated",get:function(){return this._internalState.dateUpdated}},{key:"dateCreated",get:function(){return this._internalState.dateCreated}},{key:"createdBy",get:function(){var e;return null!==(e=this._internalState.createdBy)&&void 0!==e?e:""}},{key:"attributes",get:function(){return this._internalState.attributes}},{key:"lastReadMessageIndex",get:function(){return this._internalState.lastReadMessageIndex}},{key:"lastMessage",get:function(){var e;return null!==(e=this._internalState.lastMessage)&&void 0!==e?e:void 0}},{key:"notificationLevel",get:function(){var e;return null!==(e=this._internalState.notificationLevel)&&void 0!==e?e:"default"}},{key:"bindings",get:function(){return this._internalState.bindings}},{key:"limits",get:function(){return this._configuration.limits}},{key:"state",get:function(){return this._internalState.state}},{key:"_statusSource",get:function(){return this._dataSource}},{key:"add",value:(i=O.default(D.default.mark(function e(t,n){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._participantsEntity.add(t,null!=n?n:{}));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"addNonChatParticipant",value:(r=O.default(D.default.mark(function e(t,n){var i,r,s=arguments;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.length>2&&void 0!==s[2]?s[2]:{},r=s.length>3&&void 0!==s[3]?s[3]:{},e.abrupt("return",this._participantsEntity.addNonChatParticipant(t,n,null!=i?i:{},null!=r?r:{}));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"advanceLastReadMessageIndex",value:(s=O.default(D.default.mark(function e(t){var n;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:if(!(t<(null!==(n=this.lastReadMessageIndex)&&void 0!==n?n:0))){e.next=6;break}return e.next=5,this._setLastReadMessageIndex(this.lastReadMessageIndex);case 5:case 8:return e.abrupt("return",e.sent);case 6:return e.next=8,this._setLastReadMessageIndex(t);case 9:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"delete",value:(a=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.commandExecutor.mutateResource("delete",this._links.self);case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"getAttributes",value:(o=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe();case 2:return e.abrupt("return",this.attributes);case 3:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"getMessages",value:(u=O.default(D.default.mark(function e(t,n,i){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this._messagesEntity.getMessages(t,n,i));case 3:case"end":return e.stop()}},e,this)})),function(e,t,n){return u.apply(this,arguments)})},{key:"getParticipants",value:(c=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this._participantsEntity.getParticipants());case 3:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"getParticipantsCount",value:(d=O.default(D.default.mark(function e(){var t,n,i;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new en(this._configuration.links.conversations).path(this.sid).build(),e.next=3,this._services.network.get(n);case 3:return i=e.sent,e.abrupt("return",null!==(t=i.body.participants_count)&&void 0!==t?t:0);case 5:case"end":return e.stop()}},e,this)})),function(){return d.apply(this,arguments)})},{key:"getParticipantBySid",value:(l=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._participantsEntity.getParticipantBySid(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"getParticipantByIdentity",value:(p=O.default(D.default.mark(function e(){var t,n=arguments;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"",e.abrupt("return",this._participantsEntity.getParticipantByIdentity(null!=t?t:""));case 2:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"getMessagesCount",value:(f=O.default(D.default.mark(function e(){var t,n,i;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new en(this._configuration.links.conversations).path(this.sid).build(),e.next=3,this._services.network.get(n);case 3:return i=e.sent,e.abrupt("return",null!==(t=i.body.messages_count)&&void 0!==t?t:0);case 5:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"getUnreadMessagesCount",value:(h=O.default(D.default.mark(function e(){var t,n,i;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new en(this._configuration.links.myConversations).path(this.sid).build(),e.next=3,this._services.network.get(t);case 3:if(!((n=e.sent).body.conversation_sid!==this.sid)){e.next=6;break}throw Error("Conversation was not found in the user conversations list");case 6:if("number"!=typeof(i=n.body.unread_messages_count)){e.next=9;break}return e.abrupt("return",i);case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})},{key:"join",value:(y=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.commandExecutor.mutateResource("post",this._links.participants,{identity:this._configuration.userIdentity});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"leave",value:(v=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"!==this._internalState.status){e.next=3;break}return e.next=3,this._services.commandExecutor.mutateResource("delete","".concat(this._links.participants,"/").concat(this._configuration.userIdentity));case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"removeParticipant",value:(m=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._participantsEntity.remove("string"==typeof t?t:t.sid);case 2:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"sendMessage",value:(g=O.default(D.default.mark(function e(t,n,i){var r,s,a,o;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("string"==typeof t||null===t)){e.next=5;break}return e.next=3,this._messagesEntity.send(t,n,i);case 3:return a=e.sent,e.abrupt("return",null!==(s=Q(a.index))&&void 0!==s?s:0);case 5:return e.next=7,this._messagesEntity.sendMedia(t,n,i);case 7:return o=e.sent,e.abrupt("return",null!==(r=Q(o.index))&&void 0!==r?r:0);case 9:case"end":return e.stop()}},e,this)})),function(e,t,n){return g.apply(this,arguments)})},{key:"prepareMessage",value:function(){return new eE(this.limits,this._messagesEntity)}},{key:"setAllMessagesRead",value:(b=O.default(D.default.mark(function e(){var t;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this.getMessages(1);case 4:if(!((t=e.sent).items.length>0)){e.next=7;break}return e.abrupt("return",this.advanceLastReadMessageIndex(t.items[0].index));case 7:return e.abrupt("return",0);case 8:case"end":return e.stop()}},e,this)})),function(){return b.apply(this,arguments)})},{key:"setAllMessagesUnread",value:(_=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this._setLastReadMessageIndex(null);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(){return _.apply(this,arguments)})},{key:"setUserNotificationLevel",value:(k=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.commandExecutor.mutateResource("post","".concat(this._configuration.links.myConversations,"/").concat(this.sid),{notification_level:t});case 2:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"typing",value:function(){return this._services.typingIndicator.send(this.sid)}},{key:"updateAttributes",value:(w=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.commandExecutor.mutateResource("post",this._links.self,{attributes:void 0!==t?JSON.stringify(t):void 0});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"updateFriendlyName",value:(x=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._internalState.friendlyName!==t)){e.next=3;break}return e.next=3,this._services.commandExecutor.mutateResource("post",this._links.self,{friendly_name:t});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)})},{key:"updateLastReadMessageIndex",value:(C=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this._setLastReadMessageIndex(t));case 3:case"end":return e.stop()}},e,this)})),function(e){return C.apply(this,arguments)})},{key:"updateUniqueName",value:(S=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._internalState.uniqueName!==t)){e.next=4;break}return t||(t=""),e.next=4,this._services.commandExecutor.mutateResource("post",this._links.self,{unique_name:t});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)})),function(e){return S.apply(this,arguments)})},{key:"_subscribe",value:(P=O.default(D.default.mark(function e(){var t=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._entityPromise){e.next=2;break}return e.abrupt("return",this._entityPromise);case 2:return this._entityPromise=this._services.syncClient.document({id:this._entityName,mode:"open_existing"}),e.prev=3,e.next=6,this._entityPromise;case 6:return this._entity=e.sent,this._entity.on("updated",function(e){return t._update(e.data)}),this._entity.on("removed",function(){return t.emit("removed",t)}),this._update(this._entity.data),e.abrupt("return",this._entity);case 13:throw e.prev=13,e.t0=e.catch(3),this._entity=null,this._entityPromise=null,"disconnected"!=this._services.syncClient.connectionState&&L._logger.error("Failed to get conversation object",e.t0),L._logger.debug("ERROR: Failed to get conversation object",e.t0),e.t0;case 20:case"end":return e.stop()}},e,this,[[3,13]])})),function(){return P.apply(this,arguments)})},{key:"_fetchStreams",value:(E=O.default(D.default.mark(function e(){var t,n,i;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe();case 2:return L._logger.trace("_streamsAvailable, this.entity.data=",null===(t=this._entity)||void 0===t?void 0:t.data),i=null===(n=this._entity)||void 0===n?void 0:n.data,e.next=6,this._services.syncClient.list({id:i.messages,mode:"open_existing"});case 6:return this._messagesList=e.sent,e.next=9,this._services.syncClient.map({id:i.roster,mode:"open_existing"});case 9:this._participantsMap=e.sent;case 10:case"end":return e.stop()}},e,this)})),function(){return E.apply(this,arguments)})},{key:"_subscribeStreams",value:(R=O.default(D.default.mark(function e(){var t,n,i,r,s,a,o;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._subscribe();case 3:return L._logger.trace("_subscribeStreams, this.entity.data=",null===(t=this._entity)||void 0===t?void 0:t.data),a=(s=null===(n=this._entity)||void 0===n?void 0:n.data).messages,o=s.roster,e.next=9,Promise.all([this._messagesEntity.subscribe(null!==(i=this._messagesList)&&void 0!==i?i:a),this._participantsEntity.subscribe(null!==(r=this._participantsMap)&&void 0!==r?r:o)]);case 9:e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(0),"disconnected"!==this._services.syncClient.connectionState&&L._logger.error("Failed to subscribe on conversation objects",this.sid,e.t0),L._logger.debug("ERROR: Failed to subscribe on conversation objects",this.sid,e.t0),e.t0;case 16:case"end":return e.stop()}},e,this,[[0,11]])})),function(){return R.apply(this,arguments)})},{key:"_unsubscribe",value:(T=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._entity){e.next=5;break}return e.next=3,this._entity.close();case 3:this._entity=null,this._entityPromise=null;case 5:return e.abrupt("return",Promise.all([this._participantsEntity.unsubscribe(),this._messagesEntity.unsubscribe()]));case 6:case"end":return e.stop()}},e,this)})),function(){return T.apply(this,arguments)})},{key:"_setStatus",value:function(e,t){var n=this;if(this._dataSource=t,this._internalState.status!==e){if(this._internalState.status=e,"joined"===e){this._subscribeStreams().catch(function(t){if(L._logger.debug("ERROR while setting conversation status "+e,t),"disconnected"!==n._services.syncClient.connectionState)throw t});return}this._entityPromise&&this._unsubscribe().catch(function(t){if(L._logger.debug("ERROR while setting conversation status "+e,t),"disconnected"!==n._services.syncClient.connectionState)throw t})}}},{key:"_update",value:function(e){L._logger.trace("_update",e),L.preprocessUpdate(e,this.sid);for(var t,n,i,r,s,a=new Set,o=0,u=Object.keys(e);o<u.length;o++){var c=u[o],d=eT[c];if(d)switch(d){case eT.status:if(!e.status||"unknown"===e.status||this._internalState.status===e.status)break;this._internalState.status=e.status,a.add(d);break;case eT.attributes:if(z.default(this._internalState.attributes,e.attributes))break;this._internalState.attributes=e.attributes,a.add(d);break;case eT.lastConsumedMessageIndex:if(void 0===e.lastConsumedMessageIndex||e.lastConsumedMessageIndex===this._internalState.lastReadMessageIndex)break;this._internalState.lastReadMessageIndex=e.lastConsumedMessageIndex,a.add("lastReadMessageIndex");break;case eT.lastMessage:if(this._internalState.lastMessage&&!e.lastMessage){delete this._internalState.lastMessage,a.add(d);break}this._internalState.lastMessage=this._internalState.lastMessage||{},(null===(t=e.lastMessage)||void 0===t?void 0:t.index)!==void 0&&e.lastMessage.index!==this._internalState.lastMessage.index&&(this._internalState.lastMessage.index=e.lastMessage.index,a.add(d)),(null===(n=e.lastMessage)||void 0===n?void 0:n.timestamp)!==void 0&&(null===(i=this._internalState.lastMessage)||void 0===i?void 0:null===(r=i.dateCreated)||void 0===r?void 0:r.getTime())!==e.lastMessage.timestamp.getTime()&&(this._internalState.lastMessage.dateCreated=e.lastMessage.timestamp,a.add(d)),z.default(this._internalState.lastMessage,{})&&delete this._internalState.lastMessage;break;case eT.state:var l=e.state||void 0;if(void 0!==l&&(l.dateUpdated=new Date(l.dateUpdated)),z.default(this._internalState.state,l))break;this._internalState.state=l,a.add(d);break;case eT.bindings:if(z.default(this._internalState.bindings,e.bindings))break;this._internalState.bindings=e.bindings,a.add(d);break;default:var p=e[c]instanceof Date,f=p&&(null===(s=this._internalState[d])||void 0===s?void 0:s.getTime())===e[c].getTime(),h=!p&&this[d]===e[c];if(f||h)break;this._internalState[d]=e[c],a.add(d)}}a.size>0&&this.emit("updated",{conversation:this,updateReasons:q.default(a)})}},{key:"_onMessageAdded",value:function(e){var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return eR(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eR(e,t)}}(e))){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}(this._participants.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.identity===e.author){i._endTyping();break}}}catch(r){n.e(r)}finally{n.f()}this.emit("messageAdded",e)}},{key:"_setLastReadMessageIndex",value:(j=O.default(D.default.mark(function e(t){var n;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.commandExecutor.mutateResource("post","".concat(this._configuration.links.myConversations,"/").concat(this.sid),{last_read_message_index:t});case 2:return n=e.sent,e.abrupt("return",n.unread_messages_count);case 4:case"end":return e.stop()}},e,this)})),function(e){return j.apply(this,arguments)})}],[{key:"preprocessUpdate",value:function(e,t){try{"string"==typeof e.attributes?e.attributes=JSON.parse(e.attributes):e.attributes&&JSON.stringify(e.attributes)}catch(n){L._logger.warn("Retrieved malformed attributes from the server for conversation: "+t),e.attributes={}}try{e.dateCreated&&(e.dateCreated=new Date(e.dateCreated))}catch(i){L._logger.warn("Retrieved malformed dateCreated from the server for conversation: "+t),delete e.dateCreated}try{e.dateUpdated&&(e.dateUpdated=new Date(e.dateUpdated))}catch(r){L._logger.warn("Retrieved malformed dateUpdated from the server for conversation: "+t),delete e.dateUpdated}try{e.lastMessage&&e.lastMessage.timestamp&&(e.lastMessage.timestamp=new Date(e.lastMessage.timestamp))}catch(s){L._logger.warn("Retrieved malformed lastMessage.timestamp from the server for conversation: "+t),delete e.lastMessage.timestamp}}}]),L}(g.ReplayEventEmitter);j.default(eO,"participantJoined","participantJoined"),j.default(eO,"participantLeft","participantLeft"),j.default(eO,"participantUpdated","participantUpdated"),j.default(eO,"messageAdded","messageAdded"),j.default(eO,"messageRemoved","messageRemoved"),j.default(eO,"messageUpdated","messageUpdated"),j.default(eO,"typingEnded","typingEnded"),j.default(eO,"typingStarted","typingStarted"),j.default(eO,"updated","updated"),j.default(eO,"removed","removed"),j.default(eO,"_logger",$.scope("Conversation")),G([m.validateTypesAsync(m.nonEmptyString,er),H("design:type",Function),H("design:paramtypes",[String,Object]),H("design:returntype",Promise)],eO.prototype,"add",null),G([m.validateTypesAsync(m.nonEmptyString,m.nonEmptyString,er),H("design:type",Function),H("design:paramtypes",[String,String,Object,Object]),H("design:returntype",Promise)],eO.prototype,"addNonChatParticipant",null),G([m.validateTypesAsync(m.nonNegativeInteger),H("design:type",Function),H("design:paramtypes",[Number]),H("design:returntype",Promise)],eO.prototype,"advanceLastReadMessageIndex",null),G([m.validateTypesAsync(["undefined",m.nonNegativeInteger],["undefined",m.nonNegativeInteger],["undefined",m.literal("backwards","forward")]),H("design:type",Function),H("design:paramtypes",[Number,Number,String]),H("design:returntype",Promise)],eO.prototype,"getMessages",null),G([m.validateTypesAsync(m.nonEmptyString),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],eO.prototype,"getParticipantBySid",null),G([m.validateTypesAsync(m.nonEmptyString),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],eO.prototype,"getParticipantByIdentity",null),G([m.validateTypesAsync([m.nonEmptyString,el]),H("design:type",Function),H("design:paramtypes",[Object]),H("design:returntype",Promise)],eO.prototype,"removeParticipant",null),G([m.validateTypesAsync(["string",FormData,m.literal(null),m.objectSchema("media options",{contentType:m.nonEmptyString,media:m.custom(function(e){var t="string"==typeof e&&e.length>0||e instanceof Uint8Array||e instanceof ArrayBuffer;return"function"==typeof Blob&&(t=t||e instanceof Blob),[t,"a non-empty string, an instance of Buffer or an instance of Blob"]})})],er,["undefined",m.literal(null),m.objectSchema("email attributes",{subject:[m.nonEmptyString,"undefined"]})]),H("design:type",Function),H("design:paramtypes",[Object,Object,Object]),H("design:returntype",Promise)],eO.prototype,"sendMessage",null),G([m.validateTypesAsync(m.literal("default","muted")),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],eO.prototype,"setUserNotificationLevel",null),G([m.validateTypesAsync(ei),H("design:type",Function),H("design:paramtypes",[Object]),H("design:returntype",Promise)],eO.prototype,"updateAttributes",null),G([m.validateTypesAsync("string"),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],eO.prototype,"updateFriendlyName",null),G([m.validateTypesAsync([m.literal(null),m.nonNegativeInteger]),H("design:type",Function),H("design:paramtypes",[Number]),H("design:returntype",Promise)],eO.prototype,"updateLastReadMessageIndex",null),G([m.validateTypesAsync(["string",m.literal(null)]),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],eO.prototype,"updateUniqueName",null);var eM=function(){function e(){var t=this;F.default(this,e),this._promise=new Promise(function(e,n){t._resolve=e,t._reject=n})}return A.default(e,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}}]),e}();function eU(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return eI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eI(e,t)}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function eI(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function eN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function ej(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eN(Object(n),!0).forEach(function(t){j.default(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eN(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eA=$.scope("Conversations"),eF=function(e){U.default(y,e);var t,n,i,r,s,a,o,u,c,d,l,p,f,h=(n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=N.default(y);if(n){var i=N.default(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return I.default(this,e)});function y(e,t){var n;return F.default(this,y),n=h.call(this),j.default(M.default(n),"conversations",new Map),j.default(M.default(n),"myConversationsRead",new eM),j.default(M.default(n),"tombstones",new Set),j.default(M.default(n),"myConversationsFetched",!1),n.configuration=e,n.services=t,n}return A.default(y,[{key:"addConversation",value:(i=O.default(D.default.mark(function e(t){var n,i,r,s,a,o,u,c,d,l;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=void 0!==(null==t?void 0:t.attributes)?t.attributes:{},e.next=3,this.services.commandExecutor.mutateResource("post",this.configuration.links.conversations,{friendly_name:t.friendlyName,unique_name:t.uniqueName,attributes:void 0!==s?JSON.stringify(s):void 0});case 3:if(o=null!==(n=(a=e.sent).sid)&&void 0!==n?n:null,u=null!==(i=null===(r=a.sync_objects)||void 0===r?void 0:r.conversation)&&void 0!==i?i:null,c=ej({self:a.url},a.links),!(d=this.conversations.get(o))){e.next=12;break}return e.next=11,d._subscribe();case 11:return e.abrupt("return",d);case 12:return l=new eO({channel:u,entityName:"",uniqueName:"",attributes:null,createdBy:"",friendlyName:"",lastConsumedMessageIndex:0,dateCreated:null,dateUpdated:null},o,c,this.configuration,this.services),this.conversations.set(l.sid,l),this._registerForEvents(l),e.next=17,l._subscribe();case 17:return this.emit("conversationAdded",l),e.abrupt("return",l);case 19:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"fetchConversations",value:(r=O.default(D.default.mark(function e(){var t,n,i,r,s,a,o,u=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._getMap();case 3:return(t=e.sent).on("itemAdded",function(e){eA.debug("itemAdded: ".concat(e.item.key)),u._upsertConversation("sync",e.item.key,e.item.data)}),t.on("itemRemoved",function(e){eA.debug("itemRemoved: ".concat(e.key));var t=e.key;u.myConversationsFetched||u.tombstones.add(t);var n=u.conversations.get(t);n&&("joined"===n.status&&(n._setStatus("notParticipating","sync"),u.emit("conversationLeft",n)),u.conversations.delete(t),u.emit("conversationRemoved",n),n.emit("removed",n))}),t.on("itemUpdated",function(e){eA.debug("itemUpdated: ".concat(e.item.key)),u._upsertConversation("sync",e.item.key,e.item.data)}),e.next=9,this._fetchMyConversations();case 9:n=e.sent,i=[],r=eU(n);try{for(r.s();!(s=r.n()).done;)a=s.value,i.push(this._upsertConversation("rest",a.channel_sid,a))}catch(c){r.e(c)}finally{r.f()}return this.myConversationsRead.set(!0),e.next=16,Promise.all(i);case 16:return this.myConversationsFetched=!0,this.tombstones.clear(),eA.debug("The conversations list has been successfully fetched"),e.abrupt("return",this);case 22:throw e.prev=22,e.t0=e.catch(0),o="Failed to fetch the conversations list","disconnected"!==this.services.syncClient.connectionState&&eA.error(o,e.t0),eA.debug("ERROR: ".concat(o),e.t0),e.t0;case 28:case"end":return e.stop()}},e,this,[[0,22]])})),function(){return r.apply(this,arguments)})},{key:"getConversations",value:(s=O.default(D.default.mark(function e(){var t,n,i=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getMap();case 2:return t=e.sent,e.next=5,t.getItems();case 5:return n=e.sent,e.abrupt("return",this._wrapPaginator(n,function(e){return Promise.all(e.map(function(e){return i._upsertConversation("sync",e.key,e.data)}))}));case 7:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"getConversation",value:(a=O.default(D.default.mark(function e(t){var n,i,r,s=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getMap();case 2:return n=e.sent,e.next=5,n.getItems({key:t});case 5:return r=(0,e.sent).items.map(function(e){return s._upsertConversation("sync",e.key,e.data)}),e.abrupt("return",r.length>0?r[0]:null);case 8:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"getConversationByUniqueName",value:(o=O.default(D.default.mark(function e(t){var n,i,r,s,a;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new en(this.configuration.links.myConversations).path(t).build(),e.next=3,this.services.network.get(n);case 3:return s=(r=e.sent.body).conversation_sid,a={entityName:null,lastConsumedMessageIndex:r.last_read_message_index,status:(null==r?void 0:r.status)||"unknown",friendlyName:r.friendly_name,dateUpdated:r.date_updated,dateCreated:r.date_created,uniqueName:r.unique_name,createdBy:r.created_by,attributes:r.attributes,channel:r.sync_objects.conversation,notificationLevel:null==r?void 0:r.notification_level,sid:s},e.abrupt("return",s?this._upsertConversation("sync",s,a):null);case 8:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"peekConversation",value:(u=O.default(D.default.mark(function e(t){var n,i,r,s;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new en(this.configuration.links.conversations).path(t).build(),e.next=3,this.services.network.get(n);case 3:return s={entityName:null,status:(null==(r=e.sent.body)?void 0:r.status)||"unknown",friendlyName:r.friendly_name,dateUpdated:r.date_updated,dateCreated:r.date_created,uniqueName:r.unique_name,createdBy:r.created_by,attributes:r.attributes,channel:"".concat(t,".channel"),sid:t},e.abrupt("return",this._upsertConversation("sync",t,s));case 7:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"_getMap",value:(c=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.syncClient.map({id:this.configuration.myConversations,mode:"open_existing"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"_wrapPaginator",value:(d=O.default(D.default.mark(function e(t,n){var i,r=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(t.items);case 2:return i=e.sent,e.abrupt("return",{items:i.filter(function(e){return null!==e}),hasNextPage:t.hasNextPage,hasPrevPage:t.hasPrevPage,nextPage:function(){return t.nextPage().then(function(e){return r._wrapPaginator(e,n)})},prevPage:function(){return t.prevPage().then(function(e){return r._wrapPaginator(e,n)})}});case 4:case"end":return e.stop()}},e)})),function(e,t){return d.apply(this,arguments)})},{key:"_updateConversation",value:(l=O.default(D.default.mark(function e(t,n,i){var r,s,a;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0!==n._statusSource&&t!==n._statusSource,s="rest"!==t||"sync"===n._statusSource,!(r&&s&&"sync"!==t)){e.next=5;break}return eA.trace("upsertConversation: conversation is known from sync and came from REST, ignoring",{sid:n.sid,data:i.status,conversation:n.status}),e.abrupt("return");case 5:if(!("joined"===i.status&&"joined"!==n.status)){e.next=15;break}return n._setStatus("joined",t),a={},void 0!==i.notificationLevel&&(a.notificationLevel=i.notificationLevel),void 0!==i.lastConsumedMessageIndex&&(a.lastConsumedMessageIndex=i.lastConsumedMessageIndex),z.default(a,{})||n._update(a),e.next=13,n._subscribe();case 13:return this.emit("conversationJoined",n),e.abrupt("return");case 15:if(!("notParticipating"===i.status&&"joined"===n.status)){e.next=22;break}return n._setStatus("notParticipating",t),n._update(i),e.next=20,n._subscribe();case 20:return this.emit("conversationLeft",n),e.abrupt("return");case 22:if("notParticipating"!==i.status){e.next=26;break}return e.next=25,n._subscribe();case 25:return e.abrupt("return");case 26:n._update(i);case 27:case"end":return e.stop()}},e,this)})),function(e,t,n){return l.apply(this,arguments)})},{key:"_upsertConversation",value:(p=O.default(D.default.mark(function e(t,n,i){var r,s,a,o;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(eA.trace("upsertConversation called for ".concat(n),i),!(r=this.conversations.get(n))){e.next=9;break}return eA.trace("upsertConversation: the conversation ".concat(r.sid," is known;")+"its status is known from the source ".concat(r._statusSource," ")+"and the update came from the source ".concat(t),r),e.next=6,this._updateConversation(t,r,i);case 6:return e.next=8,r._subscribe();case 8:return e.abrupt("return",r);case 9:if(!("rest"===t&&this.tombstones.has(n))){e.next=12;break}return eA.trace("upsertChannel: the conversation is deleted but reappeared again from REST, ignoring",n),e.abrupt("return",null);case 12:return eA.trace("upsertConversation: creating a local conversation object with sid "+n,i),a={self:s="".concat(this.configuration.links.conversations,"/").concat(n),messages:"".concat(s,"/Messages"),participants:"".concat(s,"/Participants")},o=new eO(i,n,a,this.configuration,this.services),this.conversations.set(n,o),e.prev=17,e.next=20,o._subscribe();case 20:if("joined"!==i.status){e.next=23;break}return e.next=23,o._fetchStreams();case 23:e.next=32;break;case 25:if(e.prev=25,e.t0=e.catch(17),!("SyncError"!==e.t0.name)){e.next=29;break}throw e.t0;case 29:return eA.trace("upsertChannel: the conversation is missing some Sync entity(ies), ignoring",n,e.t0),this.conversations.delete(n),e.abrupt("return",null);case 32:return this._registerForEvents(o),this.emit("conversationAdded",o),"joined"===i.status&&(o._setStatus("joined",t),this.emit("conversationJoined",o)),e.abrupt("return",o);case 36:case"end":return e.stop()}},e,this,[[17,25]])})),function(e,t,n){return p.apply(this,arguments)})},{key:"_fetchMyConversations",value:(f=O.default(D.default.mark(function e(){var t,n,i,r,s,a;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=null;case 2:return r=new en(this.configuration.links.myConversations),n&&r.arg("PageToken",n),e.next=6,this.services.network.get(r.build());case 6:a=null===(i=(s=e.sent).body)||void 0===i?void 0:i.conversations.map(function(e){return{descriptor:e,channel_sid:e.conversation_sid,status:e.status,channel:e.sync_objects.conversation,messages:e.sync_objects.messages,roster:"".concat(e.conversation_sid,".roster"),lastConsumedMessageIndex:e.last_read_message_index,notificationLevel:e.notification_level}}),n=s.body.meta.next_token,t=[].concat(q.default(t),q.default(a));case 10:if(n){e.next=2;break}case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"_onConversationRemoved",value:function(e){var t=this.conversations.get(e);t&&(this.conversations.delete(e),this.emit("conversationRemoved",t))}},{key:"_registerForEvents",value:function(e){var t=this;e.on("removed",function(){return t._onConversationRemoved(e.sid)}),e.on("updated",function(e){return t.emit("conversationUpdated",e)}),e.on("participantJoined",function(e){return t.emit("participantJoined",e)}),e.on("participantLeft",function(e){return t.emit("participantLeft",e)}),e.on("participantUpdated",function(e){return t.emit("participantUpdated",e)}),e.on("messageAdded",function(e){return t.emit("messageAdded",e)}),e.on("messageUpdated",function(e){return t.emit("messageUpdated",e)}),e.on("messageRemoved",function(e){return t.emit("messageRemoved",e)}),e.on("typingStarted",function(e){return t.emit("typingStarted",e)}),e.on("typingEnded",function(e){return t.emit("typingEnded",e)})}}]),y}(g.ReplayEventEmitter),eD=function(e){U.default(o,e);var t,n,i,r,s,a=(n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=N.default(o);if(n){var i=N.default(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return I.default(this,e)});function o(e,t,n){var i;return F.default(this,o),(i=a.call(this)).configuration=t,i.services=n,i.fifoStack=[],i.myself=e,i.myself.on("updated",function(e){return i.emit("userUpdated",e)}),i.myself.on("userSubscribed",function(){return i.emit("userSubscribed",i.myself)}),i.myself.on("userUnsubscribed",function(){i.emit("userUnsubscribed",i.myself),i.myself._ensureFetched()}),i.subscribedUsers=new Map,i}return A.default(o,[{key:"handleUnsubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)&&this.subscribedUsers.delete(e.identity);var t=0;this.fifoStack.find(function(n,i){return n==e.identity&&(t=i,!0)})&&this.fifoStack.splice(t,1),this.emit("userUnsubscribed",e)}},{key:"handleSubscribeUser",value:function(e){if(!this.subscribedUsers.has(e.identity)){if(this.fifoStack.length>=this.configuration.userInfosToSubscribe){var t,n,i=this.fifoStack.shift();null===(t=this.subscribedUsers)||void 0===t||null===(n=t.get(i))||void 0===n||n.unsubscribe()}this.fifoStack.push(e.identity),this.subscribedUsers.set(e.identity,e),this.emit("userSubscribed",e)}}},{key:"getUser",value:(i=O.default(D.default.mark(function e(t,n){var i,r,s,a=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.myself._ensureFetched();case 2:if(t!=this.myself.identity){e.next=4;break}return e.abrupt("return",this.myself);case 4:if(!(i=this.subscribedUsers.get(t))){e.next=7;break}return e.abrupt("return",i);case 7:if(!(null!==(s=n)&&void 0!==s)){e.next=11;break}e.next=14;break;case 11:return e.next=13,this.getSyncUniqueName(t);case 13:n=e.sent;case 14:return(r=new ea(t,n,this.configuration,this.services)).on("updated",function(e){return a.emit("userUpdated",e)}),r.on("userSubscribed",function(){return a.handleSubscribeUser(r)}),r.on("userUnsubscribed",function(){return a.handleUnsubscribeUser(r)}),e.next=20,r._ensureFetched();case 20:return e.abrupt("return",r);case 21:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"getSubscribedUsers",value:(r=O.default(D.default.mark(function e(){var t;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.myself._ensureFetched();case 2:return t=[this.myself],this.subscribedUsers.forEach(function(e){return t.push(e)}),e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getSyncUniqueName",value:(s=O.default(D.default.mark(function e(t){var n,i,r,s;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new en(this.configuration.links.users).path(t).build(),e.next=3,this.services.network.get(r);case 3:return s=e.sent,e.abrupt("return",null!==(n=null===(i=s.body)||void 0===i?void 0:i.sync_objects.user_info_map)&&void 0!==n?n:"");case 5:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})}]),o}(g.ReplayEventEmitter),eB=$.scope("TypingIndicator"),eL=function(){var e;function t(e,n,i){F.default(this,t),this.configuration=n,this.services=i,this.getConversation=e,this.serviceTypingTimeout=null,this.sentUpdates=new Map}return A.default(t,[{key:"typingTimeout",get:function(){return this.configuration.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.configuration.typingIndicatorTimeoutDefault}},{key:"initialize",value:function(){var e,t=this;this.services.notificationClient.on("message",(e=O.default(D.default.mark(function e(n,i){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n!==ec.TYPING_INDICATOR){e.next=3;break}return e.next=3,t._handleRemoteTyping(i);case 3:case"end":return e.stop()}},e)})),function(t,n){return e.apply(this,arguments)}))}},{key:"_handleRemoteTyping",value:(e=O.default(D.default.mark(function e(t){var n=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:eB.trace("Got new typing indicator ",t),this.getConversation(t.channel_sid).then(function(e){e&&e._participants.forEach(function(e){if(e.identity===t.identity){var i=n.configuration.typingIndicatorTimeoutOverride?n.configuration.typingIndicatorTimeoutOverride+1e3:1e3*t.typing_timeout;e._startTyping(i)}})}).catch(function(e){throw eB.error(e),e});case 2:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"send",value:function(e){var t=this.sentUpdates.get(e);return t&&t>Date.now()-this.typingTimeout?Promise.resolve():(this.sentUpdates.set(e,Date.now()),this._send(e))}},{key:"_send",value:function(e){var t=this;eB.trace("Sending typing indicator");var n=this.configuration.links.typing,i="ChannelSid=".concat(e);return this.services.twilsockClient.post(n,{"Content-Type":"application/x-www-form-urlencoded"},i,this.configuration.productId).then(function(e){e.body.hasOwnProperty("typing_timeout")&&(t.serviceTypingTimeout=1e3*e.body.typing_timeout)}).catch(function(e){throw eB.error("Failed to send typing indicator:",e),e})}}]),t}(),ez=A.default(function e(t){F.default(this,e),this.title=t.title||null,this.body=t.body||null,this.sound=t.sound||null,this.badge=t.badge||null,this.action=t.action||null,this.type=t.type||null,this.data=t.data||{}}),eJ="2.2.0";function eq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function eG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eq(Object(n),!0).forEach(function(t){j.default(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eq(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eH=function(e){return e.replace(/(^\/+|\/+$)/g,"")},eV=function(){var e,t,n;function i(e,t,n){F.default(this,i),this._serviceUrl=e,this._services=t,this._productId=n}return A.default(i,[{key:"_preProcessUrl",value:function(e){var t=eH(e);return/^https?:\/\//.test(e)?t:"".concat(eH(this._serviceUrl),"/").concat(t)}},{key:"_makeRequest",value:(e=O.default(D.default.mark(function e(t,n,i,r){var s,a,o,u;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s=this._preProcessUrl(n),a=eG({"Content-Type":"application/json; charset=utf-8"},r||{}),e.t0=t,e.next="get"===e.t0?5:"post"===e.t0?11:"delete"===e.t0?15:19;break;case 5:return u=s,i&&(u+="?"+Object.entries(i).map(function(e){return e.map(encodeURIComponent).join("=")}).join("&")),e.next=9,this._services.transport.get(u,a,this._productId);case 9:case 13:case 17:return o=e.sent,e.abrupt("break",19);case 11:return e.next=13,this._services.transport.post(s,a,JSON.stringify(i),this._productId);case 15:return e.next=17,this._services.transport.delete(s,a,{},this._productId);case 19:if(!(o.status.code<200||o.status.code>=300)){e.next=21;break}throw Error("Request responded with a non-success code ".concat(o.status.code));case 21:return e.abrupt("return",o);case 22:case"end":return e.stop()}},e,this)})),function(t,n,i,r){return e.apply(this,arguments)})},{key:"fetchResource",value:(t=O.default(D.default.mark(function e(t,n){var i,r,s=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=6,e.prev=1,e.next=4,new k.AsyncRetrier({min:50,max:1600,maxAttemptsCount:i}).run(function(){return s._makeRequest("get",t,n)});case 4:return r=e.sent,e.abrupt("return",r.body);case 8:throw e.prev=8,e.t0=e.catch(1),Error('Fetch resource from "'.concat(t,'" failed.'));case 11:case"end":return e.stop()}},e,null,[[1,8]])})),function(e,n){return t.apply(this,arguments)})},{key:"mutateResource",value:(n=O.default(D.default.mark(function e(t,n,i){var r;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._makeRequest(t,n,i,{"X-Twilio-Mutation-Id":R.v4()});case 2:var s;if(202!==(s=r=e.sent).status.code){e.next=7;break}return e.next=6,this.fetchResource(r.body.resource_url);case 6:return e.abrupt("return",e.sent);case 7:return e.abrupt("return",r.body);case 8:case"end":return e.stop()}},e,this)})),function(e,t,i){return n.apply(this,arguments)})}]),i}();function eW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function e$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eW(Object(n),!0).forEach(function(t){j.default(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eW(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eY=A.default(function e(){F.default(this,e)});t.Client=(i=function(e){U.default(_,e);var t,n,i,s,a,o,u,c,d,l,p,f,h,y,v,m,g,b=(n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=N.default(_);if(n){var i=N.default(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return I.default(this,e)});function _(e){var t,n,i,s,a,o,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(F.default(this,_),o=b.call(this),j.default(M.default(o),"version",eJ),j.default(M.default(o),"connectionState","unknown"),j.default(M.default(o),"parsePushNotification",r.parsePushNotification),o._fpaToken=null!=e?e:"",o._options=null!=u?u:{},!o._options.disableDeepClone){var c,d=e$(e$({},o._options),{},{transport:void 0,twilsockClient:void 0});(d=JSON.parse(JSON.stringify(c=d))).transport=o._options.transport,d.twilsockClient=o._options.twilsockClient,o._options=d}o._options.logLevel=null!==(t=o._options.logLevel)&&void 0!==t?t:"silent",r._logger.setLevel(o._options.logLevel);var l=o._options.productId="ip_messaging";if(o._options.clientMetadata=o._options.clientMetadata||{},o._options.clientMetadata.hasOwnProperty("type")||(o._options.clientMetadata.type="conversations"),o._options.clientMetadata.hasOwnProperty("sdk")||(o._options.clientMetadata.sdk="JS",o._options.clientMetadata.sdkv=eJ),o._options.Sync=o._options.Sync||{},void 0===o._options.Sync.enableSessionStorage&&(o._options.Sync.enableSessionStorage=!0),o._options.region&&(o._options.Sync.region=o._options.region),!e)throw Error("A valid Twilio token should be provided");o._services=new eY,o._myself=new ea("","",null,o._services);var p=!o._options.twilsockClient;if(!o._options.initRegistrations){var f=new w.InitRegistration(l);r.populateInitRegistrations(f),o._options.initRegistrations=[f]}o._services.twilsockClient=o._options.twilsockClient=null!==(n=o._options.twilsockClient)&&void 0!==n?n:new w.TwilsockClient(e,l,o._options),o._services.twilsockClient.on("tokenAboutToExpire",function(){return o.emit("tokenAboutToExpire")}),o._services.twilsockClient.on("tokenExpired",function(){return o.emit("tokenExpired")}),o._services.twilsockClient.on("connectionError",function(e){return o.emit("connectionError",e)}),o._services.twilsockClient.on("stateChanged",function(e){r._logger.debug("Handling stateChanged for ConversationsClient: new state ".concat(e)),e!==o.connectionState&&(o.connectionState=e,o.emit("connectionStateChanged",o.connectionState))}),o._services.transport=o._options.transport=null!==(i=o._options.transport)&&void 0!==i?i:o._options.twilsockClient,o._services.notificationClient=o._options.notificationsClient=null!==(s=o._options.notificationsClient)&&void 0!==s?s:new x.Notifications(e,o._options),o._services.syncClient=o._options.syncClient=null!==(a=o._options.syncClient)&&void 0!==a?a:new C.SyncClient(e,o._options);var h=(null==u?void 0:u.Chat)||(null==u?void 0:u.IPMessaging)||u||{},y=h.region||(null==u?void 0:u.region),v=h.apiUri||h.typingUri||"https://aim.".concat(y||"us1",".twilio.com");o._services.commandExecutor=new eV(v,{transport:o._options.transport},l);var m=function(e){o._rejectEnsureReady(e),o.emit("stateChanged","failed"),o.emit("initFailed",{error:e})},g=function(){m({terminal:!0,message:"Twilsock has disconnected."})};return o._services.twilsockClient.once("connectionError",m),o._services.twilsockClient.once("disconnected",g),o._services.twilsockClient.once("connected",O.default(D.default.mark(function e(){var t,n;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r._logger.debug("ConversationsClient started INITIALIZING"),o._services.twilsockClient.off("connectionError",m),o._services.twilsockClient.off("disconnected",g),e.prev=3,t="conversations.client.startup",o._services.twilsockClient.addPartialTelemetryEvent(new w.TelemetryEventDescription(t,"Conversations client startup",new Date),t,w.TelemetryPoint.Start),e.next=8,o._initialize();case 8:o._services.twilsockClient.addPartialTelemetryEvent(new w.TelemetryEventDescription("","",new Date),t,w.TelemetryPoint.End),e.next=17;break;case 11:e.prev=11,e.t0=e.catch(3),n={terminal:!0,message:e.t0.message},o._rejectEnsureReady(n),o.emit("stateChanged","failed"),o.emit("initFailed",{error:n});case 17:case"end":return e.stop()}},e,null,[[3,11]])}))),o._ensureReady=new Promise(function(e,t){o._resolveEnsureReady=e,o._rejectEnsureReady=t}).catch(function(){}),p&&o._services.twilsockClient.connect(),o}return A.default(_,[{key:"user",get:function(){return this._myself}},{key:"reachabilityEnabled",get:function(){if(!this._configuration)throw Error("Reachability information could not yet be accessed as the client has not yet been initialized. Subscribe to the 'stateChanged' event to properly react to the client initialization.");return this._configuration.reachabilityEnabled}},{key:"token",get:function(){return this._fpaToken}},{key:"shutdown",value:(i=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this._services.twilsockClient.disconnect();case 4:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"updateToken",value:(s=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:if(r._logger.info("updateToken"),this._fpaToken!==t){e.next=5;break}return e.abrupt("return",this);case 5:return e.next=7,this._services.twilsockClient.updateToken(t);case 7:return e.next=9,this._services.notificationClient.updateToken(t);case 9:return e.next=11,this._services.mcsClient.updateToken(t);case 11:return this._fpaToken=t,e.abrupt("return",this);case 13:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"getConversationBySid",value:(a=O.default(D.default.mark(function e(t){var n;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this._conversationsEntity.myConversationsRead.promise;case 4:return e.next=6,this._conversationsEntity.getConversation(t);case 6:if(n=e.sent){e.next=12;break}return E.deprecationWarning("The method getConversationBySid is deprecated to retrieve conversations you're not part of. Use peekConversationBySid instead."),e.next=11,this.peekConversationBySid(t);case 11:n=e.sent;case 12:if(n){e.next=14;break}throw Error("Conversation with SID ".concat(t," was not found."));case 14:return e.abrupt("return",n);case 15:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"peekConversationBySid",value:(o=O.default(D.default.mark(function e(t){var n;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this._conversationsEntity.peekConversation(t);case 4:if(n=e.sent){e.next=7;break}throw Error("Conversation with SID ".concat(t," was not found."));case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"getConversationByUniqueName",value:(u=O.default(D.default.mark(function e(t){var n;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this._conversationsEntity.myConversationsRead.promise;case 4:return e.next=6,this._conversationsEntity.getConversationByUniqueName(t);case 6:if(n=e.sent){e.next=9;break}throw Error("Conversation with unique name ".concat(t," was not found."));case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"getSubscribedConversations",value:(c=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.abrupt("return",this._conversationsPromise.then(function(e){return e.getConversations()}));case 3:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"createConversation",value:(d=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return t=t||{},e.abrupt("return",this._conversationsPromise.then(function(e){return e.addConversation(t)}));case 4:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"setPushRegistrationId",value:(l=O.default(D.default.mark(function e(t,n){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return this._subscribeToPushNotifications(t),this._services.notificationClient.setPushRegistrationId(t,n),e.next=6,this._services.notificationClient.commitChanges();case 6:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"unsetPushRegistrationId",value:(p=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return this._unsubscribeFromPushNotifications(t),e.next=5,this._services.notificationClient.commitChanges();case 5:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"removePushRegistrations",value:(f=O.default(D.default.mark(function e(t,n){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.notificationClient.removeRegistrations(t,n);case 2:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"handlePushNotification",value:(h=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:r._logger.debug("handlePushNotification, notificationPayload=",t),this.emit("pushNotification",r.parsePushNotification(t));case 4:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"getUser",value:(y=O.default(D.default.mark(function e(t){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.abrupt("return",this._services.users.getUser(t));case 3:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"getSubscribedUsers",value:(v=O.default(D.default.mark(function e(){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.abrupt("return",this._services.users.getSubscribedUsers());case 3:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"getTemporaryContentUrlsForMediaSids",value:function(e){var t,n=this;return new S.CancellablePromise((t=O.default(D.default.mark(function t(i,r,s){var a,o;return D.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(!n._services.mcsClient||!e)){t.next=3;break}return r(Error("Media Content Service is unavailable")),t.abrupt("return");case 3:return a=n._services.mcsClient.mediaSetGetContentUrls(e),s(function(){a.cancel()}),t.prev=5,t.next=8,a;case 8:i(t.sent),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(5),r(t.t0);case 15:case"end":return t.stop()}},t,null,[[5,12]])})),function(e,n,i){return t.apply(this,arguments)}))}},{key:"getTemporaryContentUrlsForMedia",value:function(e){var t=e.map(function(e){return e.sid});return this.getTemporaryContentUrlsForMediaSids(t)}},{key:"_initialize",value:(m=O.default(D.default.mark(function e(){var t,n=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.commandExecutor.fetchResource("Client/v2/Configuration");case 2:return t=e.sent,this._configuration=new K(this._options,t,r._logger),this._myself._resolveInitialization(this._configuration,this._configuration.userIdentity,this._configuration.userInfo,!0),this._services.typingIndicator=new eL(this.getConversationBySid.bind(this),this._configuration,this._services),this._services.network=new eu(this._configuration,this._services),this._services.users=new eD(this._myself,this._configuration,this._services),this._services.users.on("userSubscribed",function(e){n.emit("userSubscribed",e)}),this._services.users.on("userUpdated",function(e){return n.emit("userUpdated",e)}),this._services.users.on("userUnsubscribed",function(e){n.emit("userUnsubscribed",e)}),this._conversationsEntity=new eF(this._configuration,this._services),this._conversationsEntity.on("conversationAdded",function(e){n.emit("conversationAdded",e)}),this._conversationsEntity.on("conversationRemoved",function(e){n.emit("conversationRemoved",e)}),this._conversationsEntity.on("conversationJoined",function(e){n.emit("conversationJoined",e)}),this._conversationsEntity.on("conversationLeft",function(e){n.emit("conversationLeft",e)}),this._conversationsEntity.on("conversationUpdated",function(e){return n.emit("conversationUpdated",e)}),this._conversationsEntity.on("participantJoined",function(e){n.emit("participantJoined",e)}),this._conversationsEntity.on("participantLeft",function(e){n.emit("participantLeft",e)}),this._conversationsEntity.on("participantUpdated",function(e){return n.emit("participantUpdated",e)}),this._conversationsEntity.on("messageAdded",function(e){return n.emit("messageAdded",e)}),this._conversationsEntity.on("messageUpdated",function(e){return n.emit("messageUpdated",e)}),this._conversationsEntity.on("messageRemoved",function(e){return n.emit("messageRemoved",e)}),this._conversationsEntity.on("typingStarted",function(e){return n.emit("typingStarted",e)}),this._conversationsEntity.on("typingEnded",function(e){return n.emit("typingEnded",e)}),this._conversationsPromise=this._conversationsEntity.fetchConversations().then(function(){return n._conversationsEntity}).catch(function(e){throw e}),e.next=28,this._services.users.myself._ensureFetched();case 28:r._supportedPushChannels.forEach(function(e){return n._subscribeToPushNotifications(e)}),this._services.typingIndicator.initialize(),this._services.mcsClient=new S.McsClient(this._fpaToken,this._configuration.links.mediaService,this._configuration.links.mediaSetService,e$(e$({},this._options),{},{transport:void 0})),this._resolveEnsureReady(),this.emit("stateChanged","initialized"),this.emit("initialized");case 34:case"end":return e.stop()}},e,this)})),function(){return m.apply(this,arguments)})},{key:"_subscribeToPushNotifications",value:function(e){var t=this;[ec.NEW_MESSAGE,ec.ADDED_TO_CONVERSATION,ec.REMOVED_FROM_CONVERSATION,ec.TYPING_INDICATOR,ec.CONSUMPTION_UPDATE].forEach(function(n){t._services.notificationClient.subscribe(e,n)})}},{key:"_unsubscribeFromPushNotifications",value:function(e){var t=this;[ec.NEW_MESSAGE,ec.ADDED_TO_CONVERSATION,ec.REMOVED_FROM_CONVERSATION,ec.TYPING_INDICATOR,ec.CONSUMPTION_UPDATE].forEach(function(n){t._services.notificationClient.unsubscribe(e,n)})}}],[{key:"create",value:(g=O.default(D.default.mark(function e(t,n){var i;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null!=n&&n.twilsockClient)){e.next=2;break}throw Error("Obsolete usage of ConversationsClient.create() factory method: if you pass twilsock from the outside then you must use ConversationsClient constructor and be prepared to work with uninitialized client.");case 2:return i=new r(t,n),e.next=5,i._ensureReady;case 5:return e.abrupt("return",i);case 6:case"end":return e.stop()}},e)})),function(e,t){return g.apply(this,arguments)})},{key:"parsePushNotification",value:function(e){if(r._logger.debug("parsePushNotification, notificationPayload=",e),void 0!==e.aps){if(!e.twi_message_type)throw Error("Provided push notification payload does not contain Programmable Chat push notification type");var t,n,i,s=r._parsePushNotificationChatData(e),a=e.aps,o=null;return"string"==typeof a.alert?t=a.alert||null:(t=(null===(n=a.alert)||void 0===n?void 0:n.body)||null,o=(null===(i=a.alert)||void 0===i?void 0:i.title)||null),new ez({title:o,body:t,sound:a.sound||null,badge:a.badge||null,action:a.category||null,type:e.twi_message_type,data:s})}if(void 0!==e.data){var u=e.data;if(!u.twi_message_type)throw Error("Provided push notification payload does not contain Programmable Chat push notification type");var c=r._parsePushNotificationChatData(e.data);return new ez({title:u.twi_title||null,body:u.twi_body||null,sound:u.twi_sound||null,badge:null,action:u.twi_action||null,type:u.twi_message_type,data:c})}throw Error("Provided push notification payload is not Programmable Chat notification")}},{key:"_parsePushNotificationChatData",value:function(e){var t={};for(var n in r._supportedPushDataFields){var i=e[n];if(null!=i){if("message_index"===n||"media_count"===n){var s=Q(i);null!==s&&(t[r._supportedPushDataFields[n]]=s);continue}if("media"===n){if("string"==typeof i)try{t[r._supportedPushDataFields[n]]=JSON.parse(i)}catch(a){r._logger.debug("Media message notification parsing error")}continue}t[r._supportedPushDataFields[n]]=i}}return t}},{key:"populateInitRegistrations",value:function(e){e.populateInitRegistrations([ec.TYPING_INDICATOR]),C.SyncClient.populateInitRegistrations(e)}}]),_}(g.ReplayEventEmitter),j.default(i,"conversationAdded","conversationAdded"),j.default(i,"conversationJoined","conversationJoined"),j.default(i,"conversationLeft","conversationLeft"),j.default(i,"conversationRemoved","conversationRemoved"),j.default(i,"conversationUpdated","conversationUpdated"),j.default(i,"participantJoined","participantJoined"),j.default(i,"participantLeft","participantLeft"),j.default(i,"participantUpdated","participantUpdated"),j.default(i,"messageAdded","messageAdded"),j.default(i,"messageRemoved","messageRemoved"),j.default(i,"messageUpdated","messageUpdated"),j.default(i,"tokenAboutToExpire","tokenAboutToExpire"),j.default(i,"tokenExpired","tokenExpired"),j.default(i,"typingEnded","typingEnded"),j.default(i,"typingStarted","typingStarted"),j.default(i,"pushNotification","pushNotification"),j.default(i,"userSubscribed","userSubscribed"),j.default(i,"userUnsubscribed","userUnsubscribed"),j.default(i,"userUpdated","userUpdated"),j.default(i,"stateChanged","stateChanged"),j.default(i,"initialized","initialized"),j.default(i,"initFailed","initFailed"),j.default(i,"connectionStateChanged","connectionStateChanged"),j.default(i,"connectionError","connectionError"),j.default(i,"version",eJ),j.default(i,"_logger",$.scope("Client")),j.default(i,"_supportedPushChannels",["fcm","apn"]),j.default(i,"_supportedPushDataFields",{conversation_sid:"conversationSid",conversation_title:"conversationTitle",message_sid:"messageSid",message_index:"messageIndex",media_count:"mediaCount",media:"media"}),r=i),G([E.deprecated("token"),H("design:type",String),H("design:paramtypes",[])],t.Client.prototype,"token",null),G([m.validateTypesAsync(m.nonEmptyString),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],t.Client.prototype,"updateToken",null),G([m.validateTypesAsync(m.nonEmptyString),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],t.Client.prototype,"getConversationBySid",null),G([m.validateTypesAsync(m.nonEmptyString),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],t.Client.prototype,"peekConversationBySid",null),G([m.validateTypesAsync(m.nonEmptyString),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],t.Client.prototype,"getConversationByUniqueName",null),G([m.validateTypesAsync(["undefined",m.objectSchema("conversation options",{friendlyName:["string","undefined"],isPrivate:["boolean","undefined"],uniqueName:["string","undefined"]})]),H("design:type",Function),H("design:paramtypes",[Object]),H("design:returntype",Promise)],t.Client.prototype,"createConversation",null),G([m.validateTypesAsync(m.literal("fcm","apn"),"string"),H("design:type",Function),H("design:paramtypes",[String,String]),H("design:returntype",Promise)],t.Client.prototype,"setPushRegistrationId",null),G([m.validateTypesAsync(m.literal("fcm","apn")),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],t.Client.prototype,"unsetPushRegistrationId",null),G([m.validateTypesAsync(m.literal("fcm","apn"),m.nonEmptyString),H("design:type",Function),H("design:paramtypes",[String,String]),H("design:returntype",Promise)],t.Client.prototype,"removePushRegistrations",null),G([m.validateTypesAsync(m.pureObject),H("design:type",Function),H("design:paramtypes",[Object]),H("design:returntype",Promise)],t.Client.prototype,"handlePushNotification",null),G([m.validateTypesAsync(m.nonEmptyString),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],t.Client.prototype,"getUser",null),G([m.validateTypesAsync(m.nonEmptyArray("strings","string")),H("design:type",Function),H("design:paramtypes",[Array]),H("design:returntype",S.CancellablePromise)],t.Client.prototype,"getTemporaryContentUrlsForMediaSids",null),G([m.validateTypesAsync(m.nonEmptyArray("media",eh)),H("design:type",Function),H("design:paramtypes",[Array]),H("design:returntype",S.CancellablePromise)],t.Client.prototype,"getTemporaryContentUrlsForMedia",null),G([E.deprecated("Client.create()","new Client()"),m.validateTypesAsync("string",["undefined",m.pureObject]),H("design:type",Function),H("design:paramtypes",[String,Object]),H("design:returntype",Promise)],t.Client,"create",null),G([m.validateTypes(m.pureObject),H("design:type",Function),H("design:paramtypes",[Object]),H("design:returntype",ez)],t.Client,"parsePushNotification",null),t.Client=r=G([m.validateConstructorTypes(m.nonEmptyString,[m.pureObject,"undefined"]),H("design:paramtypes",[String,Object])],t.Client),Object.defineProperty(t,"CancellablePromise",{enumerable:!0,get:function(){return S.CancellablePromise}}),t.AggregatedDeliveryReceipt=ey,t.Conversation=eO,t.DetailedDeliveryReceipt=em,t.Media=eh,t.Message=ek,t.MessageBuilder=eE,t.NotificationTypes=ec,t.Participant=el,t.PushNotification=ez,t.RestPaginator=ev,t.UnsentMessage=eP,t.User=ea}}]);